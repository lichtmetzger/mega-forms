/* (c) 2022 Mega Forms - https://wpmegaforms.com */
!function(r,l,a){"use strict";const d={formID:0,init:e=>{d.formID=e;d.initEvents();d.initActions()},initEvents:()=>{r("#mform_fields").on("click",".mf-conditional-logic-inputs",function(e){d.handleConditionalLogic(e)})},initActions:()=>{l.hooks.addAction("editor.insertContainer","editor",function(e){d.handleContainerInsert(e)});l.hooks.addAction("editor.deleteContainer","editor",function(e,t){d.handleContainerDelete(e,t)});l.hooks.addFilter("editor.containerData","editor",function(e,t){return d.getContainerData(e,t)});l.hooks.addAction("editor.fieldSelect","editor",function(e){d.refreshConditionalOptions(e)});l.hooks.addAction("editor.fieldPreviewUpdate","editor",function(e,t,n){d.handleFieldPreviewUpdate(e,t,n)});l.hooks.addAction("editor.fieldEditorUpdate","editor",function(e,t,n){d.handleFieldEditorUpdate(e,t,n)})},handleConditionalLogic:s=>{if(s.target)if(s.target.matches(".add_conditional_rule_btn")||s.target.closest(".add_conditional_rule_btn")){let e=s.target.matches(".add_conditional_rule_btn")?s.target:s.target.closest(".add_conditional_rule_btn"),t=e.closest(".mf-conditional-rule"),n=t.cloneNode(!0),i=n.querySelectorAll("input, select"),l=t.closest(".mf-conditional-logic-rules"),o=l.querySelectorAll(".mf-conditional-rule"),a=l.getAttribute("data-group"),r=parseInt(t.getAttribute("data-key")),d=0;for(let e=0;o.length>e;e++){var f=parseInt(o[e].getAttribute("data-key"));f>=d&&(d=f+1)}n.setAttribute("data-key",d);for(let n=0;i.length>n;n++){let e=i[n].getAttribute("name"),t=e.replace("[groups]["+a+"]["+r+"]","[groups]["+a+"]["+d+"]");i[n].setAttribute("name",t);i[n].classList.contains("mf-condition-rule-operator")?i[n].value="is":i[n].value=""}t.parentNode.insertBefore(n,t.nextSibling)}else if(s.target.matches(".remove_conditional_rule_btn")||s.target.closest(".remove_conditional_rule_btn")){let e=s.target.matches(".remove_conditional_rule_btn")?s.target:s.target.closest(".remove_conditional_rule_btn"),t=e.closest(".mf-conditional-rule"),n=t.closest(".mf-conditional-logic-rules"),i=n.querySelectorAll(".mf-conditional-rule"),l=n.closest(".mf-conditional-logic-inputs"),o=l.querySelectorAll(".mf-conditional-logic-rules");1===i.length&&1===o.length?Snackbar.show({text:a.text.removeConditionN,customClass:"warning"}):(1===i.length&&1<o.length?n:t).remove()}else if(s.target.matches(".add_rules_group_btn")||s.target.closest(".add_rules_group_btn")){let e=s.target.matches(".add_rules_group_btn")?s.target:s.target.closest(".add_rules_group_btn"),t=e.closest(".mf-conditional-logic-inputs"),n=t.querySelectorAll(".mf-conditional-logic-rules"),i=n[0].cloneNode(!0),l=i.querySelectorAll(".mf-conditional-rule"),o=parseInt(i.getAttribute("data-group")),a=0;for(let e=0;n.length>e;e++){var r=parseInt(n[e].getAttribute("data-group"));r>=a&&(a=r+1)}i.setAttribute("data-group",a);for(let e=0;l.length>e;e++)if(0===e){let i=l[e].querySelectorAll("input, select");for(let n=0;i.length>n;n++){let e=i[n].getAttribute("name"),t=e.replace("[groups]["+o+"]","[groups]["+a+"]");i[n].setAttribute("name",t);i[n].classList.contains("mf-condition-rule-operator")?i[n].value="is":i[n].value=""}}else l[e].remove();e.parentNode.insertBefore(i,e)}},handleContainerInsert:a=>{if("page"==a){if(0===r("#mfields_holder").find(".mfpage_break").length){let e=wp.template("mfpage_top"),t=wp.template("mfpage_bottom"),n=wp.template("mfpage_settings");r(e({})).insertBefore(r("#mfields_holder"));r(t({})).insertAfter(r("#mfields_holder"));r("#mfcontainers_settings").append(n)}else{a=r("#mfcontainers_settings").find('form.mf_container_global_settings[data-type="page"]');if(0<a.length){let e=r(a).find(".pagesettings_pagename").last(),n=r(e).attr("data-number"),t=r(e).find("label").text(),i=r(e).clone(),l=parseInt(n)+1,o=t.replace(n,l);r(i).html(function(e,t){return t=(t=t.replaceAll("pagesettings_pagename_"+n,"pagesettings_pagename_"+l)).replace("page_names["+n+"]","page_names["+l+"]")});r(i).attr("data-number",l);r(i).find("label").text(o);r(i).find("input").val(o);r(i).insertAfter(e)}}let e=wp.template("mfpage_break"),t=e({});r(t).insertAfter(r("#mfields_holder").find(".mf-container").last())}},handleContainerDelete:(n,i)=>{if("page"==n){let t=1===r("#mfields_holder").find(".mfpage_break").length;Snackbar.show({text:a.text.removeContainerY,showButton:!0,buttonText:a.text.yes,onButtonClick:function(e){e.style.opacity=0;r(i).fadeOut(300,function(){if(t){r("#mega-body-fields").find(".mfpage_top").remove();r("#mega-body-fields").find(".mfpage_bottom").remove();r("#mfcontainers_settings").find('[data-type="'+n+'"]').remove()}else{var e=r("#mfcontainers_settings").find('form.mf_container_global_settings[data-type="page"]');0<e.length&&r(e).find(".pagesettings_pagename").last().remove()}r(this).remove()})}})}},getContainerData:(e,t)=>{if("page"==e.type){var n=r("#mfields_holder").find(".mfpage_break"),i=r(t).find("form.mf_container_options");e.page=r(n).index(t)+2;0<i.length&&(e=Object.assign(e,l.serializeForm(i)))}return e},handleFieldPreviewUpdate:(e,t,n)=>{var i=r(t).closest(".field_container").data("id"),i=r("#mega-body-fields").find("#mf_"+d.formID+"_field_"+i),i="none"===n.target?r(i):r(i).find(n.target),l=n.action,t=r(t).getVal();"args"in n&&n.args;if(0<i.length&&"update_upload_area"===l)if(t){r(i).find(".mf_files_dropable").show();r(i).find('input[type="file"].mf-upload').hide()}else{r(i).find(".mf_files_dropable").hide();r(i).find('input[type="file"].mf-upload').show()}},handleFieldEditorUpdate:(e,t,n)=>{var i=r(t).closest(".field_container"),l="none"===n.target?r(i):r(i).find(n.target),o=n.action,t=r(t).getVal();"args"in n&&n.args;if(0<l.length&&"handle_conditional_logic_swtich"===o)if(!1===t){n=r(i).find(".mf-conditional-logic-inputs");r(n).prop({hidden:!0});r(n).find("input, select").prop({disabled:!0})}else{l=r(i).find(".mf-conditional-logic-inputs");r(l).prop({hidden:!1});r(l).find("input, select").prop({disabled:!1});d.refreshConditionalOptions(i[0])}},refreshConditionalOptions:(e,t=!1)=>{let d=0;if("number"==typeof e){d=e;e=document.getElementById("mform_fields").querySelector('.field_container[data-id="'+e+'"]')}else d=parseInt(e.getAttribute("data-id"));if(null==e||void 0===e)return!1;var n=e.querySelector(".mf-conditional-logic-enable"),i=null!==n&&n.checked;if(null!==n&&(i||t)){let o=document.getElementById("mfields_holder").querySelectorAll(".single_field"),a=e.querySelectorAll(".mf-condition-rule-parent"),r=[];for(let n=0;o.length>n;n++){var l=o[n].getAttribute("data-is-static")||0;if(!l){let i=o[n].querySelector(".mf_label"),l=o[n].getAttribute("data-id"),e=o[n].querySelector(".mf_input_compound"),t=null!==e;if(t){let t=e.querySelectorAll(".mf_sub_field");if(0<t.length)for(let e=0;t.length>e;e++){let n=t[e].querySelector(".mf_sub_label");if(n){let e=n.textContent,t=n.getAttribute("id");r.push({id:parseInt(l),label:null!==i?i.textContent+" ("+e+")":"("+e+")",subKey:t.substring(t.indexOf("["))})}}}else r.push({id:parseInt(l),label:null!==i?i.textContent:""})}}for(let o=0;a.length>o;o++){let n="",i=a[o].value.substr(0,a[o].value.indexOf("|")),l=a[o].value.substring(a[o].value.indexOf("["));var s=a[o].options.length;if(0<s)for(let e=s;0<e;e--)a[o].remove(a[o].o);for(let t=0;r.length>t;t++){let e=document.createElement("option");e.text=r[t].label;e.value=r[t].id+"|"+r[t].label;"subKey"in r[t]&&(e.value+="|"+r[t].subKey);""===i||parseInt(i)!=r[t].id||"subKey"in r[t]&&!("subKey"in r[t]&&r[t].subKey==l)||(n=e.value);r[t].id===d&&e.setAttribute("disabled","disabled");a[o].add(e)}a[o].value=n}}}};l.hooks.addAction("editor.initialized","editor",function(e){d.init(e)})}(jQuery,megaForms,mfVars);