/* (c) 2023 Mega Forms - https://wpmegaforms.com */
!function(s,a,l){"use strict";const d={formID:0,init:e=>{d.formID=e;d.initEvents();d.initActions()},initEvents:()=>{s("#mform_actions").on("change",".mf-action-field-switch",function(e){var t=e.target,n=s(t).data("edit");d.handleFieldEditorUpdate(e,t,n)});s("#mform_fields, #mform_actions").on("click",".mf-conditional-logic-inputs, .mf-custom-fields-inputs",function(e){d.handleRepeatableGroups(e)})},initActions:()=>{a.hooks.addAction("editor.insertContainer","editor",function(e){d.handleContainerInsert(e)});a.hooks.addAction("editor.deleteContainer","editor",function(e,t){d.handleContainerDelete(e,t)});a.hooks.addFilter("editor.containerData","editor",function(e,t){return d.getContainerData(e,t)});a.hooks.addAction("editor.fieldSelect","editor",function(e){d.refreshConditionalOptions(e)});a.hooks.addAction("editor.actionSelect","action",function(e){d.refreshConditionalOptions(e)});a.hooks.addAction("editor.fieldPreviewUpdate","editor",function(e,t,n){d.handleFieldPreviewUpdate(e,t,n)});a.hooks.addAction("editor.fieldEditorUpdate","editor",function(e,t,n){d.handleFieldEditorUpdate(e,t,n)})},handleRepeatableGroups:d=>{if(d.target)if(d.target.matches(".add_conditional_rule_btn")||d.target.closest(".add_conditional_rule_btn")){d.preventDefault();let e=d.target.matches(".add_conditional_rule_btn")?d.target:d.target.closest(".add_conditional_rule_btn"),t=e.closest(".mf-conditional-rule"),n=t.cloneNode(!0),i=n.querySelectorAll("input, select"),a=t.closest(".mf-conditional-logic-rules"),l=a.querySelectorAll(".mf-conditional-rule"),o=a.getAttribute("data-group"),r=parseInt(t.getAttribute("data-key")),s=0;for(let e=0;l.length>e;e++){var f=parseInt(l[e].getAttribute("data-key"));f>=s&&(s=f+1)}n.setAttribute("data-key",s);for(let e=0;i.length>e;e++){var c=i[e].getAttribute("name").replace("[groups]["+o+"]["+r+"]","[groups]["+o+"]["+s+"]");i[e].setAttribute("name",c);i[e].classList.contains("mf-condition-rule-operator")?i[e].value="is":i[e].value=""}t.parentNode.insertBefore(n,t.nextSibling)}else if(d.target.matches(".remove_conditional_rule_btn")||d.target.closest(".remove_conditional_rule_btn")){d.preventDefault();var e=(d.target.matches(".remove_conditional_rule_btn")?d.target:d.target.closest(".remove_conditional_rule_btn")).closest(".mf-conditional-rule"),t=e.closest(".mf-conditional-logic-rules"),n=t.querySelectorAll(".mf-conditional-rule"),i=t.closest(".mf-conditional-logic-inputs").querySelectorAll(".mf-conditional-logic-rules");1===n.length&&1===i.length?Snackbar.show({text:l.text.removeConditionN,customClass:"warning"}):(1===n.length&&1<i.length?t:e).remove()}else if(d.target.matches(".add_rules_group_btn")||d.target.closest(".add_rules_group_btn")){d.preventDefault();let e=d.target.matches(".add_rules_group_btn")?d.target:d.target.closest(".add_rules_group_btn"),t=e.closest(".mf-conditional-logic-inputs"),n=t.querySelectorAll(".mf-conditional-logic-rules"),i=n[0].cloneNode(!0),a=i.querySelectorAll(".mf-conditional-rule"),l=parseInt(i.getAttribute("data-group")),o=0;for(let e=0;n.length>e;e++){var r=parseInt(n[e].getAttribute("data-group"));r>=o&&(o=r+1)}i.setAttribute("data-group",o);for(let e=0;a.length>e;e++)if(0===e){var s=a[e].querySelectorAll("input, select");for(let e=0;s.length>e;e++){var u=s[e].getAttribute("name").replace("[groups]["+l+"]","[groups]["+o+"]");s[e].setAttribute("name",u);s[e].classList.contains("mf-condition-rule-operator")?s[e].value="is":s[e].value=""}}else a[e].remove();e.parentNode.insertBefore(i,e)}else if(d.target.matches(".add_custom_field_btn")||d.target.closest(".add_custom_field_btn")){d.preventDefault();let e=d.target.matches(".add_custom_field_btn")?d.target:d.target.closest(".add_custom_field_btn"),t=e.closest(".mf-custom-meta-field"),n=t.cloneNode(!0),i=n.querySelectorAll("input, select"),a=t.closest(".mf-custom-meta-table"),l=a.querySelectorAll(".mf-custom-meta-field"),o=parseInt(t.getAttribute("data-key")),r=0;for(let e=0;l.length>e;e++){var m=parseInt(l[e].getAttribute("data-key"));m>=r&&(r=m+1)}n.setAttribute("data-key",r);for(let e=0;i.length>e;e++){var g=i[e].getAttribute("name").replace("["+o+"]","["+r+"]");i[e].setAttribute("name",g);i[e].getAttribute("name").contains("[meta_type]")?i[e].value="string":i[e].value=""}t.parentNode.insertBefore(n,t.nextSibling)}else if(d.target.matches(".remove_custom_field_btn")||d.target.closest(".remove_custom_field_btn")){d.preventDefault();n=(d.target.matches(".remove_custom_field_btn")?d.target:d.target.closest(".remove_custom_field_btn")).closest(".mf-custom-meta-field"),i=n.closest(".mf-custom-meta-table").querySelectorAll(".mf-custom-meta-field");1===i.length&&1===i.length?Snackbar.show({text:l.text.removeCustomFieldN,customClass:"warning"}):n.remove()}},handleContainerInsert:o=>{if("page"==o){if(0===s("#mfields_holder").find(".mfpage_break").length){var o=wp.template("mfpage_top"),e=wp.template("mfpage_bottom"),t=wp.template("mfpage_settings");s(o({})).insertBefore(s("#mfields_holder"));s(e({})).insertAfter(s("#mfields_holder"));s("#mfcontainers_settings").append(t)}else{o=s("#mfcontainers_settings").find('form.mf_container_global_settings[data-type="page"]');if(0<o.length){let e=s(o).find(".pagesettings_pagename").last(),n=s(e).attr("data-number"),t=s(e).find("label").text(),i=s(e).clone(),a=parseInt(n)+1,l=t.replace(n,a);s(i).html(function(e,t){return t=(t=t.replaceAll("pagesettings_pagename_"+n,"pagesettings_pagename_"+a)).replace("page_names["+n+"]","page_names["+a+"]")});s(i).attr("data-number",a);s(i).find("label").text(l);s(i).find("input").val(l);s(i).insertAfter(e)}}e=wp.template("mfpage_break")({});s(e).insertAfter(s("#mfields_holder").find(".mf-container").last());s('.mf-containers-flyout-button[data-type="row"]').click()}},handleContainerDelete:(n,i)=>{if("page"==n){let t=1===s("#mfields_holder").find(".mfpage_break").length;Snackbar.show({text:l.text.removeContainerY,showButton:!0,buttonText:l.text.yes,onButtonClick:function(e){e.style.opacity=0;s(i).fadeOut(300,function(){if(t){s("#mega-body-fields").find(".mfpage_top").remove();s("#mega-body-fields").find(".mfpage_bottom").remove();s("#mfcontainers_settings").find('[data-type="'+n+'"]').remove()}else{var e=s("#mfcontainers_settings").find('form.mf_container_global_settings[data-type="page"]');0<e.length&&s(e).find(".pagesettings_pagename").last().remove()}s(this).remove()})}})}},getContainerData:(e,t)=>{if("page"==e.type){var n=s("#mfields_holder").find(".mfpage_break"),i=s(t).find("form.mf_container_options");e.page=s(n).index(t)+2;0<i.length&&(e=Object.assign(e,a.serializeForm(i)))}return e},handleFieldPreviewUpdate:(e,t,n)=>{var i=s(t).closest(".field_container").data("id"),i=s("#mega-body-fields").find("#mf_"+d.formID+"_field_"+i),i="none"===n.target?s(i):s(i).find(n.target),a=n.action,t=s(t).getVal();"args"in n&&n.args;if(0<i.length&&"update_upload_area"===a)if(t){s(i).find(".mf_files_dropable").show();s(i).find('input[type="file"].mf-upload').hide()}else{s(i).find(".mf_files_dropable").hide();s(i).find('input[type="file"].mf-upload').show()}},handleFieldEditorUpdate:(e,t,n)=>{var i=s(t).closest(".field_container"),a="none"===n.target?s(i):s(i).find(n.target),l=n.action,o=s(t).getVal();"args"in n&&n.args;if(0<a.length)switch(l){case"handle_conditional_logic_swtich":if(!1===o){var r=s(i).find(".mf-conditional-logic-inputs");s(r).prop({hidden:!0});s(r).find("input, select").prop({disabled:!0})}else{r=s(i).find(".mf-conditional-logic-inputs");s(r).prop({hidden:!1});s(r).find("input, select").prop({disabled:!1});d.refreshConditionalOptions(i[0])}break;case"handle_custom_fields_swtich":if(!1===o){r=s(i).find(".mf-custom-fields-inputs");s(r).prop({hidden:!0});s(r).find("input, select").prop({disabled:!0})}else{r=s(i).find(".mf-custom-fields-inputs");s(r).prop({hidden:!1});s(r).find("input, select").prop({disabled:!1})}}},refreshConditionalOptions:(e,t=!1)=>{let l=0;if("number"==typeof e){l=e;e=document.getElementById("mform_fields").querySelector('.field_container[data-id="'+l+'"]')}else l=parseInt(e.getAttribute("data-id"));if(null==e||void 0===e)return!1;var n=e.querySelector(".mf-action-field-switch"),i=null!==n&&n.checked;if(null!==n&&(i||t)){var a=document.getElementById("mfields_holder").querySelectorAll(".single_field"),o=e.querySelectorAll(".mf-condition-rule-parent"),r=[];for(let e=0;a.length>e;e++){var s=a[e].getAttribute("data-is-static")||0;if(!s){var d=a[e].querySelector(".mf_label"),f=a[e].getAttribute("data-id"),s=a[e].querySelector(".mf_input_compound");if(null!==s){var c=s.querySelectorAll(".mf_sub_field");if(0<c.length)for(let e=0;c.length>e;e++){var u=c[e].querySelector(".mf_sub_label");if(u){var m=u.textContent,u=u.getAttribute("id");u.includes("[email_confirmation]")||r.push({id:parseInt(f),label:null!==d?d.textContent+" ("+m+")":"("+m+")",subKey:u.substring(u.indexOf("["))})}}}else r.push({id:parseInt(f),label:null!==d?d.textContent:""})}}for(let a=0;o.length>a;a++){let t="",n=o[a].value.substr(0,o[a].value.indexOf("|")),i=o[a].value.substring(o[a].value.indexOf("["));var g=o[a].options.length;if(0<g)for(let e=g;0<e;e--)o[a].remove(o[a].o);for(let e=0;r.length>e;e++){var p=document.createElement("option");p.text=r[e].label;p.value=r[e].id+"|"+r[e].label;"subKey"in r[e]&&(p.value+="|"+r[e].subKey);""===n||parseInt(n)!=r[e].id||"subKey"in r[e]&&!("subKey"in r[e]&&r[e].subKey==i)||(t=p.value);r[e].id===l&&p.setAttribute("disabled","disabled");o[a].add(p)}o[a].value=t}}}};a.hooks.addAction("editor.initialized","editor",function(e){d.init(e)})}(jQuery,megaForms,mfVars);