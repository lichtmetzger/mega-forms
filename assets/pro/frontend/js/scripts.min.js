/* (c) 2023 Mega Forms - https://wpmegaforms.com */
!function(p,c){"use strict";const _={forms:null,init:function(){this.forms=p(".single-mega-form");if(0<this.forms.length){this.initEvents();this.initActions()}},initEvents:function(){p(document).on("click",".mf-submit-btn, .mf-save-btn, .mf-prev-btn, .mf-next-btn",function(e){e.currentTarget.classList.contains("mf-submit-btn")?_.submitForm.apply(this,[e]):e.currentTarget.classList.contains("mf-save-btn")?_.saveForm.apply(this,[e]):e.currentTarget.classList.contains("mf-prev-btn")?_.prevFormPage.apply(this,[e]):e.currentTarget.classList.contains("mf-next-btn")&&_.nextFormPage.apply(this,[e])});p(document).on("keydown",".mform_page input",function(e){if(13==(e.keyCode||e.which)){e.preventDefault();var r=p(this).closest(".mform_page"),s=p(r).closest("form"),n=p(r).find(".mf-next-btn");if(0<n.length)p(s).hasClass("ajax-mega-form")?_.nextFormPage.apply(n,[e]):p(n).click();else{n=p(r).find(".mf-submit-btn");p(s).hasClass("ajax-mega-form")?_.submitForm.apply(n,[e]):p(n).click()}}})},initActions:function(){c.conditionalFields(this.forms,{disableHidden:!0,debug:c.dev_env})},prevFormPage:function(e){var r,s=p(this).closest(".mform_page"),n=p(s).closest("form");if(0<s.length){e.preventDefault();e=p(s).prev(".mform_page");r=parseInt(p(n).find('[name="_mf_current_page"]').val())-1;p(s).hide();p(e).show();_.updateProgressIndicator(p(e).closest("form"),r);p(n).find(".mform_response_msg").empty().addClass("mf_hidden");p(n).find(".mf-notice-holder").remove();p(n).find(".mf_input_error").removeClass("mf_input_error");p(n).find(".mf_compound_error").removeClass("mf_compound_error");p(n).find(".mf_sub_input_error").removeClass("mf_sub_input_error")}},nextFormPage:function(e){var r=p(this).closest(".ajax-mega-form");if(0<r.length){e.preventDefault();e=c.serializeForm(r);_.ajaxSubmitForm(r,e,"page",{page:e._mf_current_page})}},saveForm:function(e){var r=p(this).closest(".ajax-mega-form");if(0<r.length){e.preventDefault();e=c.serializeForm(r);_.ajaxSubmitForm(r,e,"save")}},submitForm:function(e){var r=p(this).closest(".ajax-mega-form");if(0<r.length){e.preventDefault();e=c.serializeForm(r);_.ajaxSubmitForm(r,e)}},updateProgressIndicator:function(e,s){var r=p(e).find(".mform_pages_progress_indicator");if(0<r.length)if(0==s)p(r).remove();else if(p(r).hasClass("mform_progress_bar")){var n=p(r).find(".mf_progressbar_percentage"),o=p(n).attr("data-count")||p(e).find(".mform_page").length,o=parseInt(s)/parseInt(o)*100;p(n).css("width",o+"%");p(n).find("span").text(parseInt(o)+"%");p(n).removeClass(function(e,r){return(r.match(/percentbar_\d{1,3}/g)||[]).join(" ")});p(n).addClass("percentbar_"+parseInt(o))}else if(p(r).hasClass("mform_steps")){n=p(r).find(".mf_step");p(n).each(function(e){var r=p(this).attr("data-number")||p(this).find(".mf_step_number").text(),r=parseInt(r);p(this).removeClass("mf_step_active mf_step_pending mf_step_completed");r==s?p(this).addClass("mf_step_active"):s<r?p(this).addClass("mf_step_pending"):p(this).addClass("mf_step_completed")})}p(e).find('[name="_mf_current_page"]').val(s)},isVisible:function(e){var r=p(e).offset().top,e=r+p(e).outerHeight(),s=p(window).scrollTop(),n=s+p(window).height();return s<e&&r<n},maybeGetFileInputs:function(e){let r={},s=jQuery(e).find('[type="file"].mf-upload');0<s.length&&jQuery.each(s,function(){!this.hasAttribute("multiple")&&0<this.files.length&&(r[this.name]=this.files[0])});return r},ajaxSubmitForm:function(i,e,a="",r={}){var m=Object.prototype.hasOwnProperty.call(e,"_mf_form_id")?e._mf_form_id:"";if(void 0!==m&&""!==m){let s={form_id:m,posted_data:e,context:a,args:r},n=!1,o=!1,t=!1;if("page"==a||"save"==a){t=r.page||e._mf_current_page;o=p(i).find(".mform_page_"+t);n="page"==a?p(o).find(".mf-next-btn"):p(o).find(".mf-save-btn")}else n=p(i).find('[name="mform_submit"]');p(i).addClass("mf-mask");p(n).addClass("mf-submit-processing").append('<span class="mf-dots-spinner"> <i class="mf-dot"></i> <i class="mf-dot"></i> <i class="mf-dot"></i> </span>');var f=_.maybeGetFileInputs(i);if(0<Object.keys(f).length){let e=new FormData,r=!1;s.args.refresh_fields=[];for(var d in f){e.append(d,f[d]);s.args.refresh_fields.push(d)}for(var l in s)if("object"==typeof s[l]){r=!0;e.append(l,JSON.stringify(s[l]))}else e.append(l,s[l]);e.append("has_json",r);s=e}c.ajax({data:s,isadmin:!1,callback:"submit_form",success:function(r){if(c.dev_env){console.log("%cSuccess","color: green; background: yellow; font-size: 20px");console.log(r)}if("redirect"in r)window.location.href=r.redirect;else{p(i).removeClass("mf-mask");p(n).removeClass("mf-submit-processing");p(n).find(".mf-dots-spinner").remove();if("page"==a){p(i).find(".mform_response_msg").empty().addClass("mf_hidden");p(i).find(".mf-notice-holder").remove();p(i).find(".mf_input_error").removeClass("mf_input_error");p(i).find(".mf_compound_error").removeClass("mf_compound_error");p(i).find(".mf_sub_input_error").removeClass("mf_sub_input_error");var e=p(o).next(),s=parseInt(t)+1;p(o).hide();p(e).show();_.updateProgressIndicator(i,s)}else{p(i).find(".mform_response_msg").empty().removeClass("mf_hidden").append(r.message);p(i).find(".mf-notice-holder").remove();p(i).find(".mf_input_error").removeClass("mf_input_error");p(i).find(".mf_compound_error").removeClass("mf_compound_error");p(i).find(".mf_sub_input_error").removeClass("mf_sub_input_error");if("keep_form"in r&&!1!==r.keep_form){p(i).find(":input").each(function(e,r){p(r).attr("name").startsWith("_mf_")||p(r).val("")});p(i).find(":checked").prop("checked",!1)}else if(0<p(i).find(".mform_pages").length)p(i).find(".mform_pages").remove();else{p(i).find(".mform_body").remove();p(i).find(".mform_footer").remove()}}"hideProgressIndicator"in r&&r.hideProgressIndicator&&_.updateProgressIndicator(i,!1);"refreshedFields"in r&&r.refreshedFields&&p.each(r.refreshedFields,function(e,r){p(e).replaceWith(r)});if("scrollTop"in r&&r.scrollTop&&!_.isVisible(p(i).find(".mform_header"))){let e="html, body";"string"==typeof r.scrollTop&&0<p("response.scrollTop").length&&(e=r.scrollTop);p(e).animate({scrollTop:p(i).find(".mform_header").offset().top-80},500)}}},fail:function(r){if(c.dev_env){console.log("%cFail","color: red; background: yellow; font-size: 20px");console.log(r)}p(i).removeClass("mf-mask");p(n).removeClass("mf-submit-processing");p(n).find(".mf-dots-spinner").remove();p(i).find(".mform_response_msg").empty().removeClass("mf_hidden").append(r.message);p(i).find(".mf-notice-holder").remove();p(i).find(".mf_input_error").removeClass("mf_input_error");p(i).find(".mf_compound_error").removeClass("mf_compound_error");p(i).find(".mf_sub_input_error").removeClass("mf_sub_input_error");"notices"in r&&0<Object.keys(r.notices).length&&Object.entries(r.notices).forEach(([e,r])=>{var s=p(i).find('[name="'+e+'"]');if(0<p(s).length){s=p(s).closest(".mf_input_container");p(s).append(r);p(s).addClass("mf_input_error")}else{s=p(i).find('[name^="'+e+'["]'),e=p(s).closest(".mf_input_container");e.append(r);e.addClass("mf_input_error")}});"compound_notices"in r&&0<Object.keys(r.compound_notices).length&&Object.entries(r.compound_notices).forEach(([o,e])=>{0<Object.keys(e).length&&Object.entries(e).forEach(([e,r])=>{var e=p(i).find('[name="'+o+"["+e+']"]'),s=p(e).parent(".mf_sub_field"),n=p(e).closest(".mf_input_container");p(e).after(r);p(s).addClass("mf_sub_input_error");p(n).addClass("mf_compound_error")})});"refreshedFields"in r&&r.refreshedFields&&p.each(r.refreshedFields,function(e,r){p(e).replaceWith(r)});if("scrollTop"in r&&r.scrollTop&&!_.isVisible(p(i).find(".mform_header"))){let e="html, body";"string"==typeof r.scrollTop&&0<p("response.scrollTop").length&&(e=r.scrollTop);p(e).animate({scrollTop:p(i).find(".mform_header").offset().top-80},500)}}})}}};p(window).load(function(){_.init()})}(jQuery,megaForms,mfVars);