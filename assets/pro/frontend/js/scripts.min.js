/* (c) 2022 Mega Forms - https://wpmegaforms.com */
!function(l,c){"use strict";const _={forms:null,init:function(){this.forms=l(".single-mega-form");if(0<this.forms.length){this.initEvents();this.initActions()}},initEvents:function(){l(document).on("click",".mf-submit-btn, .mf-save-btn, .mf-prev-btn, .mf-next-btn",function(e){e.currentTarget.classList.contains("mf-submit-btn")?_.submitForm.apply(this,[e]):e.currentTarget.classList.contains("mf-save-btn")?_.saveForm.apply(this,[e]):e.currentTarget.classList.contains("mf-prev-btn")?_.prevFormPage.apply(this,[e]):e.currentTarget.classList.contains("mf-next-btn")&&_.nextFormPage.apply(this,[e])});l(document).on("keydown",".mform_page input",function(n){if(13==(n.keyCode||n.which)){n.preventDefault();let e=l(this).closest(".mform_page"),r=l(e).closest("form"),s=l(e).find(".mf-next-btn");if(0<s.length)l(r).hasClass("ajax-mega-form")?_.nextFormPage.apply(s,[n]):l(s).click();else{s=l(e).find(".mf-submit-btn");l(r).hasClass("ajax-mega-form")?_.submitForm.apply(s,[n]):l(s).click()}}})},initActions:function(){c.conditionalFields(this.forms,{disableHidden:!0,debug:c.dev_env})},prevFormPage:function(e){var r,s=l(this).closest(".mform_page"),n=l(s).closest("form");if(0<s.length){e.preventDefault();e=l(s).prev(".mform_page");r=parseInt(l(n).find('[name="_mf_current_page"]').val())-1;l(s).hide();l(e).show();_.updateProgressIndicator(l(e).closest("form"),r);l(n).find(".mform_response_msg").empty().addClass("mf_hidden");l(n).find(".mf-notice-holder").remove();l(n).find(".mf_input_error").removeClass("mf_input_error");l(n).find(".mf_compound_error").removeClass("mf_compound_error");l(n).find(".mf_sub_input_error").removeClass("mf_sub_input_error")}},nextFormPage:function(e){var r=l(this).closest(".ajax-mega-form");if(0<r.length){e.preventDefault();e=c.serializeForm(r);_.ajaxSubmitForm(r,e,"page",{page:e._mf_current_page})}},saveForm:function(e){var r=l(this).closest(".ajax-mega-form");if(0<r.length){e.preventDefault();e=c.serializeForm(r);_.ajaxSubmitForm(r,e,"save")}},submitForm:function(e){var r=l(this).closest(".ajax-mega-form");if(0<r.length){e.preventDefault();e=c.serializeForm(r);_.ajaxSubmitForm(r,e)}},updateProgressIndicator:function(e,s){var r=l(e).find(".mform_pages_progress_indicator");if(0<r.length)if(0==s)l(r).remove();else if(l(r).hasClass("mform_progress_bar")){var n=l(r).find(".mf_progressbar_percentage"),t=l(n).attr("data-count")||l(e).find(".mform_page").length,t=parseInt(s)/parseInt(t)*100;l(n).css("width",t+"%");l(n).find("span").text(parseInt(t)+"%");l(n).removeClass(function(e,r){return(r.match(/percentbar_\d{1,3}/g)||[]).join(" ")});l(n).addClass("percentbar_"+parseInt(t))}else if(l(r).hasClass("mform_steps")){n=l(r).find(".mf_step");l(n).each(function(e){var r=l(this).attr("data-number")||l(this).find(".mf_step_number").text(),r=parseInt(r);l(this).removeClass("mf_step_active mf_step_pending mf_step_completed");r==s?l(this).addClass("mf_step_active"):s<r?l(this).addClass("mf_step_pending"):l(this).addClass("mf_step_completed")})}l(e).find('[name="_mf_current_page"]').val(s)},isVisible:function(e){var r=l(e).offset().top,e=r+l(e).outerHeight(),s=l(window).scrollTop(),n=s+l(window).height();return s<e&&r<n},maybeGetFileInputs:function(e){let r={},s=jQuery(e).find('[type="file"].mf-upload');0<s.length&&jQuery.each(s,function(){!this.hasAttribute("multiple")&&0<this.files.length&&(r[this.name]=this.files[0])});return r},ajaxSubmitForm:function(o,e,a="",r={}){var m=Object.prototype.hasOwnProperty.call(e,"_mf_form_id")?e._mf_form_id:"";if(void 0!==m&&""!==m){let s={form_id:m,posted_data:e,context:a,args:r},n=!1,t=!1,i=!1;if("page"==a||"save"==a){i=r.page||e._mf_current_page;t=l(o).find(".mform_page_"+i);n="page"==a?l(t).find(".mf-next-btn"):l(t).find(".mf-save-btn")}else n=l(o).find('[name="mform_submit"]');l(o).addClass("mf-mask");l(n).addClass("mf-submit-processing").append('<span class="mf-dots-spinner"> <i class="mf-dot"></i> <i class="mf-dot"></i> <i class="mf-dot"></i> </span>');var f=_.maybeGetFileInputs(o);if(0<Object.keys(f).length){let e=new FormData,r=!1;s.args.refresh_fields=[];for(var d in f){e.append(d,f[d]);s.args.refresh_fields.push(d)}for(var p in s)if("object"==typeof s[p]){r=!0;e.append(p,JSON.stringify(s[p]))}else e.append(p,s[p]);e.append("has_json",r);s=e}c.ajax({data:s,isadmin:!1,callback:"submit_form",success:function(r){if("redirect"in r)window.location.href=r.redirect;else{l(o).removeClass("mf-mask");l(n).removeClass("mf-submit-processing");l(n).find(".mf-dots-spinner").remove();if("page"==a){l(o).find(".mform_response_msg").empty().addClass("mf_hidden");l(o).find(".mf-notice-holder").remove();l(o).find(".mf_input_error").removeClass("mf_input_error");l(o).find(".mf_compound_error").removeClass("mf_compound_error");l(o).find(".mf_sub_input_error").removeClass("mf_sub_input_error");var e=l(t).next(),s=parseInt(i)+1;l(t).hide();l(e).show();_.updateProgressIndicator(o,s)}else{l(o).find(".mform_response_msg").empty().removeClass("mf_hidden").append(r.message);l(o).find(".mf-notice-holder").remove();l(o).find(".mf_input_error").removeClass("mf_input_error");l(o).find(".mf_compound_error").removeClass("mf_compound_error");l(o).find(".mf_sub_input_error").removeClass("mf_sub_input_error");if("keep_form"in r&&!1!==r.keep_form){l(o).find(":input").each(function(e,r){l(r).attr("name").startsWith("_mf_")||l(r).val("")});l(o).find(":checked").prop("checked",!1)}else if(0<l(o).find(".mform_pages").length)l(o).find(".mform_pages").remove();else{l(o).find(".mform_body").remove();l(o).find(".mform_footer").remove()}}"hideProgressIndicator"in r&&r.hideProgressIndicator&&_.updateProgressIndicator(o,!1);"refreshedFields"in r&&r.refreshedFields&&l.each(r.refreshedFields,function(e,r){l(e).replaceWith(r)});if("scrollTop"in r&&r.scrollTop&&!_.isVisible(l(o).find(".mform_header"))){let e="html, body";"string"==typeof r.scrollTop&&0<l("response.scrollTop").length&&(e=r.scrollTop);l(e).animate({scrollTop:l(o).find(".mform_header").offset().top-80},500)}}},fail:function(r){l(o).removeClass("mf-mask");l(n).removeClass("mf-submit-processing");l(n).find(".mf-dots-spinner").remove();l(o).find(".mform_response_msg").empty().removeClass("mf_hidden").append(r.message);l(o).find(".mf-notice-holder").remove();l(o).find(".mf_input_error").removeClass("mf_input_error");l(o).find(".mf_compound_error").removeClass("mf_compound_error");l(o).find(".mf_sub_input_error").removeClass("mf_sub_input_error");"notices"in r&&0<Object.keys(r.notices).length&&Object.entries(r.notices).forEach(([s,n])=>{var e=l(o).find('[name="'+s+'"]');if(0<l(e).length){e=l(e).closest(".mf_input_container");l(e).append(n);l(e).addClass("mf_input_error")}else{let e=l(o).find('[name^="'+s+'["]'),r=l(e).closest(".mf_input_container");r.append(n);r.addClass("mf_input_error")}});"compound_notices"in r&&0<Object.keys(r.compound_notices).length&&Object.entries(r.compound_notices).forEach(([t,e])=>{0<Object.keys(e).length&&Object.entries(e).forEach(([e,r])=>{var e=l(o).find('[name="'+t+"["+e+']"]'),s=l(e).parent(".mf_sub_field"),n=l(e).closest(".mf_input_container");l(e).after(r);l(s).addClass("mf_sub_input_error");l(n).addClass("mf_compound_error")})});"refreshedFields"in r&&r.refreshedFields&&l.each(r.refreshedFields,function(e,r){l(e).replaceWith(r)});if("scrollTop"in r&&r.scrollTop&&!_.isVisible(l(o).find(".mform_header"))){let e="html, body";"string"==typeof r.scrollTop&&0<l("response.scrollTop").length&&(e=r.scrollTop);l(e).animate({scrollTop:l(o).find(".mform_header").offset().top-80},500)}}})}}};l(window).load(function(){_.init()})}(jQuery,megaForms,mfVars);