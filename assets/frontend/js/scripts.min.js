/* (c) 2023 Mega Forms - https://wpmegaforms.com */
"use strict";const megaForms={context:mfCommonVars.context,ajaxurl:mfCommonVars.ajaxurl,ajax_public_action:"megaforms_public_request",ajax_admin_action:"megaforms_admin_request",dev_env:mfCommonVars.dev_env,ajax:(n,e="POST")=>{(n=n||{}).isadmin=n.isadmin||!1;n.data=n.data||{};n.callback=n.callback.replace(/-/g,"_")||"";n.before=n.before||!1;n.success=n.success||function(e){console.log(e)};n.fail=n.fail||function(e){console.log(e)};n.error=n.error||!1;n.complete=n.complete||!1;n.debug=n.debug||!1;let t="",i=n.data instanceof FormData,r={type:e,url:megaForms.ajaxurl,success:e=>{if(n.debug)n.success(e);else{e=JSON.parse(e);if(e.success){if(e.fail)"function"==typeof n.fail&&n.fail(e);else if("function"==typeof n.success){delete e.success;delete e.fail;n.success(e)}}else{n.isadmin?alert("AJAX error, check you browser console for more details."):alert("AJAX error, please refersh and try again.");console.log(e)}}},error:(e,t,i)=>{!1!==n.error&&"function"==typeof n.error&&n.error(e,t,i);console.log("XHR ERROR "+e.status+": "+i);n.isadmin?alert("Server side error, please error log file for more details."):alert("Server side error, please refersh and try again.")}};!1!==n.before&&"function"==typeof n.before&&(r.beforeSend=n.before());!1!==n.complete&&"function"==typeof n.complete&&(r.complete=n.complete());t=n.isadmin?megaForms.ajax_admin_action:megaForms.ajax_public_action;i?n.data.append("action",t):n.data.action=t;if(i){n.data.append("callback",n.callback);r.contentType=!1;r.processData=!1}else n.data.callback=n.callback;r.data=n.data;jQuery.ajax(r)},serializeForm:(e,t=!0)=>{let i={},n=t?jQuery(e).find(":input").serializeArrayLoose():jQuery(e).find(":input").serializeArray();jQuery.each(n,function(){var e=this.value,e=function e(t,i){if(t.length<1)return i;let n=t[0];"]"==n.slice(-1)&&(n=n.slice(0,-1));var r={};if(1==t.length)r[n=""==n?i:n]=i;else{t.shift();t=e(t,i);r[n]=t}return r}(this.name.split("["),e);jQuery.extend(!0,i,e)});return i}};if("undefined"!=typeof window){window.megaForms=megaForms;if("admin"==window.megaForms.context){window.wp=window.wp||{};window.megaForms.hooks=window.wp.hooks.createHooks()||{}}if("undefined"!=typeof mfConditionalFields)window.megaForms.conditionalFields=mfConditionalFields;else{const mfConditionalFields=(s,e={})=>{switch(typeof s){case"string":s=document.querySelectorAll(s);break;case"object":if(!1===Array.isArray(s)&&Object.prototype.hasOwnProperty.call(s,"0")){s=Object.fromEntries(Object.entries(s).filter(([e,t])=>!isNaN(e)&&void 0!==t.elements));s=Object.values(s)}else s=Array.isArray(s)?s:[s]}let l=e.rules||"inline",t=e.dynamic||!1,d=e.unsetHidden||!1,u=e.disableHidden||!1,i=e.debug||!1,f=e.depth||3,c=[],m=[],n=[],g={initField:(r,a)=>{var o=r.getAttribute("data-conditional-rules");if(0<o.length){let e="container"in(o=JSON.parse(o))?o.container:"",t="action"in o?o.action:"show",i="logic"in o?o.logic:"or",n="rules"in o?o.rules:[];if(0<(n="object"==typeof n&&void 0===n.length?[n]:n).length){for(let t=0;n.length>t;t++)if("group"in n[t])for(let e=0;n[t].group.length>e;e++)"name"in n[t].group[e]&&!m[a].includes(n[t].group[e].name)&&m[a].push(n[t].group[e].name);else"name"in n[t]&&!m[a].includes(n[t].name)&&m[a].push(n[t].name);r.removeAttribute("data-conditional-rules");r.mfConditionalContainerSelector=e;r.mfConditionalAction=t;r.mfConditionalLogic=i;r.mfConditionalRules=n;r.mfConditionalFormIndex=a;g.updateField(r)}}},updateField:(e,t=1)=>{let n=e.mfConditionalFormIndex,i=e.mfConditionalAction,r=e.mfConditionalLogic,a=e.mfConditionalRules,o=!1;if(0<a.length)for(let i=0;a.length>i;i++){let t=!1;if("group"in a[i]){var l,s=a[i].relation||"and";for(let e=0;a[i].group.length>e;e++){if(0==(l=g.evaluateRule(a[i].group[e],n))&&"and"==s){t=!1;break}if(l&&"or"==s){t=!0;break}t=l}}else t=g.evaluateRule(a[i],n);if(!1===t&&"and"==r){o=!1;break}if(t&&"or"==r){o=!0;break}o=t}o||(i="hide"==i?"show":"show"==i?"hide":"disable"==i?"enable":"enable"==i?"disable":"none");g.toggleField(e,i,t)},toggleField:(e,t,i)=>{let n=e.mfConditionalFormIndex,r=e.name,a=e.mfConditionalContainerSelector,o=null;if(i<f&&m[n].includes(r)){var l=g.getDependantField(r,n);if(0<l.length)for(let e=0;l.length>e;e++)"hide"==t?g.toggleField(l[e],"hide",i++):"show"==t&&g.updateField(l[e],i++)}if("hide"==t){""==a?e.setAttribute("hidden",!0):(o=e.closest(""+a))&&o.setAttribute("hidden",!0);u&&e.setAttribute("disabled","disabled");d&&("checkbox"==e.type||"radio"==e.type?e.checked=!1:e.value="")}else if("disable"==t)e.setAttribute("disabled","disabled");else if("enable"==t)e.hasAttribute("disabled")&&e.removeAttribute("disabled");else if("show"==t){""==a?e.removeAttribute("hidden"):(o=e.closest(""+a))&&o.removeAttribute("hidden");u&&e.removeAttribute("disabled")}},getDependantField:(i,t)=>{var n=[];if(void 0!==c[t])for(let e=0;c[t].length>e;e++)if("mfConditionalRules"in c[t][e]){var r=c[t][e].mfConditionalRules.some(t=>{if("group"in t){for(let e=0;t.group.length>e;e++)if(t.group[e].name===i)return!0;return!1}return t.name===i});void 0!==r&&!1!==r&&n.push(c[t][e])}return n},evaluateRule:(r,a)=>{var o=r.name,l=r.operator,r=r.value;if(m[a].includes(o)){let t=s[a].querySelectorAll('[name="'+o+'"]'),e,i,n;if(0<t.length){"radio"!==(e=t[0].type)&&"checkbox"!==e&&(t=t[0]);if("radio"==e||"checkbox"==e){i=[];for(let e=0;e<t.length;e++){t[e].checked&&i.push(t[e].value);e===t.length-1&&(i=i.join("|"))}}else i=t.value;n=g.compareValues(l,i,r)}return n}return!1},compareValues:(e,t,i)=>{t=t?t.toString().toLowerCase():"",i=i?i.toString().toLowerCase():"";switch(e){case"is":return i===t;case"isnot":return i!==t;case"greaterthan":return!isNaN(i)&&!isNaN(t)&&Number(i)>Number(t);case"lessthan":return!isNaN(i)&&!isNaN(t)&&Number(i)<Number(t);case"contains":return t.includes(i);case"doesnotcontain":return!t.includes(i);case"beginswith":return t.startsWith(i);case"doesnotbeginwith":return!t.startsWith(i);case"endswith":return t.endsWith(i);case"doesnotendwith":return!t.endsWith(i);case"isempty":return""===t;case"isnotempty":return""!==t}return!1},updateForm:async(a,e="add")=>{if(void 0!==s[a])if("add"==e)try{let i;i=await new Promise((e,t)=>{let i=[];if("inline"==l)i=s[a].querySelectorAll("[data-conditional-rules]");else{for(let t=0;l.length>t;t++)if("field"in l[t]){var n=(n=s[a].elements[l[t].field])instanceof RadioNodeList?Array.from(n):[n];for(let e=0;n.length>e;e++)if(void 0!==n[e]){var r=n[e];r.setAttribute("data-conditional-rules",JSON.stringify(l[t]));i.push(r)}delete l[t].field}l=null}if(0<i.length){c[a]=c[a].concat(Array.prototype.slice.call(i));e(i)}else t("No conditional fields found on step 1")});await new Promise((t,e)=>{if(0<i.length)for(let e=0;i.length>e;e++){g.initField(i[e],a);e===i.length-1&&t()}else e("No conditional fields to initialize on step 2")});if(0<m.length)for(let e=0;m[a].length>e;e++)if(!n[a].includes(m[a][e])){let t=s[a].querySelectorAll('[name="'+m[a][e]+'"]');if(0===t.length&&0<(t=s[a].querySelectorAll('[type="checkbox"][name="'+m[a][e]+'[]"]')).length){var r=m[a][e],o=(m[a][e]=m[a][e]+"[]",g.getDependantField(r,a));if(0<o.length)for(let n=0;o.length>n;n++)if(0<o[n].mfConditionalRules.length){let i=!1;for(let t=0;o[n].mfConditionalRules.length>t;t++)if("group"in o[n].mfConditionalRules[t]){for(let e=0;o[n].mfConditionalRules[t].group.length>e;e++)if(o[n].mfConditionalRules[t].group[e].name==r){o[n].mfConditionalRules[t].group[e].name=r+"[]";i=!0}}else if(o[n].mfConditionalRules[t].name==r){o[n].mfConditionalRules[t].name=r+"[]";i=!0}i&&g.updateField(o[n])}}if(0<t.length){for(let e=0;t.length>e;e++){t[e].mfConditionalFormIndex=a;t[e].addEventListener("change",g.fieldListener,!1)}n[a].push(m[a][e])}t=null}return!0}catch(t){if(i){let e="formIndex: "+a;void 0!==s[a].getAttribute("id")&&(e="formId: "+s[a].getAttribute("id"));console.info(e+" => "+t)}}else if("remove"==e){c[a]=c[a].filter(e=>void 0!==s[a].elements[""+e.name]);m[a]=m[a].filter(e=>void 0!==s[a].elements[""+e]);n[a]=n[a].filter(e=>void 0!==s[a].elements[""+e]);return!0}return!1},fieldListener:e=>{var t=g.getDependantField(e.target.name,e.target.mfConditionalFormIndex);if(0<t.length)for(let e=0;t.length>e;e++)g.updateField(t[e])},formListener:e=>{var t=e.target.mfConditionalFormIndex,e=e.detail.action;g.updateForm(t,e)}};if("block"==l){e=document.getElementById("rules-mf-conditional-fields");l=JSON.parse(e.innerHTML)}if("inline"!==l&&"object"!=typeof l)return i&&console.warn("The supplied rules or rule type is not valid."),!1;if(!(0<s.length))return i&&console.warn("The supplied conditional form was not found"),!1;for(let e=0;s.length>e;e++){c.push([]);m.push([]);n.push([]);s[e].mfConditionalFormIndex=e;g.updateForm(e)}if(t)for(let e=0;s.length>e;e++)s[e].addEventListener("mfConditionalFormUpdated",g.formListener,!1)};window.megaForms.conditionalFields=mfConditionalFields}window.megaForms.maxLengthHandler=e=>{var t=e.value.length,i=parseInt(e.getAttribute("maxlength"));i<t?e.value=e.value.substring(0,i):e.closest(".mf_input_container").querySelector("#mf_char_num").textContent=t+"/"+i};"undefined"!=typeof jQuery&&(jQuery.fn.serializeArrayLoose=function(){var n=/\r?\n/g,t=/^(?:submit|button|image|reset|file)$/i,i=/^(?:input|select|textarea|keygen)/i,r=/^(?:checkbox|radio)$/i;return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&i.test(this.nodeName)&&!t.test(e)&&(this.checked||!r.test(e))}).map(function(e,t){var i=jQuery(this).val();null==i&&(i="");return Array.isArray(i)?jQuery.map(i,function(e){return{name:t.name,value:e.replace(n,"\r\n")}}):{name:t.name,value:i.replace(n,"\r\n")}}).get()})}!function(n){const e={formID:0,init:function(){this.initDatePicker();this.initInputMask()},initDatePicker:function(){void 0!==n.fn.datepicker&&n(".mform_fields").find(".datepicker-here").each(function(){var e={},t=n(this).attr("data-date-from"),i=n(this).attr("data-date-to");e.language="en";e.minDate=t?new Date(t+"-01-01"):new Date;if(i)e.maxDate=new Date(i+"-12-31");else{e.maxDate=new Date;e.maxDate.setFullYear(e.maxDate.getFullYear()+9)}n(this).datepicker(e)})},initInputMask:function(){n.fn.mask}};n(window).load(function(){e.init()})}(jQuery,(megaForms,mfVars));