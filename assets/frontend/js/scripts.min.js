/* (c) 2023 Mega Forms - https://wpmegaforms.com */
"use strict";const megaForms={context:mfCommonVars.context,ajaxurl:mfCommonVars.ajaxurl,ajax_public_action:"megaforms_public_request",ajax_admin_action:"megaforms_admin_request",dev_env:mfCommonVars.dev_env,ajax:(i,e="POST")=>{(i=i||{}).isadmin=i.isadmin||!1;i.data=i.data||{};i.callback=i.callback.replace(/-/g,"_")||"";i.before=i.before||!1;i.success=i.success||function(e){console.log(e)};i.fail=i.fail||function(e){console.log(e)};i.error=i.error||!1;i.complete=i.complete||!1;i.debug=i.debug||!1;let t="",n=i.data instanceof FormData,o={type:e,url:megaForms.ajaxurl,success:e=>{if(i.debug)i.success(e);else{e=JSON.parse(e);if(e.success){if(e.fail)"function"==typeof i.fail&&i.fail(e);else if("function"==typeof i.success){delete e.success;delete e.fail;i.success(e)}}else{i.isadmin?alert("AJAX error, check you browser console for more details."):alert("AJAX error, please refersh and try again.");console.log(e)}}},error:(e,t,n)=>{!1!==i.error&&"function"==typeof i.error&&i.error(e,t,n);console.log("XHR ERROR "+e.status+": "+n);i.isadmin?alert("Server side error, please error log file for more details."):alert("Server side error, please refersh and try again.")}};!1!==i.before&&"function"==typeof i.before&&(o.beforeSend=i.before());!1!==i.complete&&"function"==typeof i.complete&&(o.complete=i.complete());t=i.isadmin?megaForms.ajax_admin_action:megaForms.ajax_public_action;n?i.data.append("action",t):i.data.action=t;if(n){i.data.append("callback",i.callback);o.contentType=!1;o.processData=!1}else i.data.callback=i.callback;o.data=i.data;jQuery.ajax(o)},serializeForm:(e,t=!0)=>{let n={},i=t?jQuery(e).find(":input").serializeArrayLoose():jQuery(e).find(":input").serializeArray();jQuery.each(i,function(){var e=this.value,e=function e(t,n){if(t.length<1)return n;let i=t[0];"]"==i.slice(-1)&&(i=i.slice(0,-1));var o={};if(1==t.length)o[i=""==i?n:i]=n;else{t.shift();t=e(t,n);o[i]=t}return o}(this.name.split("["),e);jQuery.extend(!0,n,e)});return n}};if("undefined"!=typeof window){window.megaForms=megaForms;if("admin"==window.megaForms.context){window.wp=window.wp||{};window.megaForms.hooks=window.wp.hooks.createHooks()||{}}if("undefined"!=typeof mfConditionalFields)window.megaForms.conditionalFields=mfConditionalFields;else{const mfConditionalFields=(s,e={})=>{switch(typeof s){case"string":s=document.querySelectorAll(s);break;case"object":if(!1===Array.isArray(s)&&Object.prototype.hasOwnProperty.call(s,"0")){s=Object.fromEntries(Object.entries(s).filter(([e,t])=>!isNaN(e)&&void 0!==t.elements));s=Object.values(s)}else s=Array.isArray(s)?s:[s]}let l=e.rules||"inline",t=e.dynamic||!1,d=e.unsetHidden||!1,u=e.disableHidden||!1,n=e.debug||!1,f=e.depth||3,c=[],m=[],i=[],g={initField:(o,a)=>{var r=o.getAttribute("data-conditional-rules");if(0<r.length){let e="container"in(r=JSON.parse(r))?r.container:"",t="action"in r?r.action:"show",n="logic"in r?r.logic:"or",i="rules"in r?r.rules:[];if(0<(i="object"==typeof i&&void 0===i.length?[i]:i).length){for(let t=0;i.length>t;t++)if("group"in i[t])for(let e=0;i[t].group.length>e;e++)"name"in i[t].group[e]&&!m[a].includes(i[t].group[e].name)&&m[a].push(i[t].group[e].name);else"name"in i[t]&&!m[a].includes(i[t].name)&&m[a].push(i[t].name);o.removeAttribute("data-conditional-rules");o.mfConditionalContainerSelector=e;o.mfConditionalAction=t;o.mfConditionalLogic=n;o.mfConditionalRules=i;o.mfConditionalFormIndex=a;g.updateField(o)}}},updateField:(e,t=1)=>{let i=e.mfConditionalFormIndex,n=e.mfConditionalAction,o=e.mfConditionalLogic,a=e.mfConditionalRules,r=!1;if(0<a.length)for(let n=0;a.length>n;n++){let t=!1;if("group"in a[n]){var l,s=a[n].relation||"and";for(let e=0;a[n].group.length>e;e++){if(0==(l=g.evaluateRule(a[n].group[e],i))&&"and"==s){t=!1;break}if(l&&"or"==s){t=!0;break}t=l}}else t=g.evaluateRule(a[n],i);if(!1===t&&"and"==o){r=!1;break}if(t&&"or"==o){r=!0;break}r=t}r||(n="hide"==n?"show":"show"==n?"hide":"disable"==n?"enable":"enable"==n?"disable":"none");g.toggleField(e,n,t)},toggleField:(e,t,n)=>{let i=e.mfConditionalFormIndex,o=e.name,a=e.mfConditionalContainerSelector,r=null;if(n<f&&m[i].includes(o)){var l=g.getDependantField(o,i);if(0<l.length)for(let e=0;l.length>e;e++)"hide"==t?g.toggleField(l[e],"hide",n++):"show"==t&&g.updateField(l[e],n++)}if("hide"==t){""==a?e.setAttribute("hidden",!0):(r=e.closest(""+a))&&r.setAttribute("hidden",!0);u&&e.setAttribute("disabled","disabled");d&&("checkbox"==e.type||"radio"==e.type?e.checked=!1:e.value="")}else if("disable"==t)e.setAttribute("disabled","disabled");else if("enable"==t)e.hasAttribute("disabled")&&e.removeAttribute("disabled");else if("show"==t){""==a?e.removeAttribute("hidden"):(r=e.closest(""+a))&&r.removeAttribute("hidden");u&&e.removeAttribute("disabled")}},getDependantField:(n,t)=>{var i=[];if(void 0!==c[t])for(let e=0;c[t].length>e;e++)if("mfConditionalRules"in c[t][e]){var o=c[t][e].mfConditionalRules.some(t=>{if("group"in t){for(let e=0;t.group.length>e;e++)if(t.group[e].name===n)return!0;return!1}return t.name===n});void 0!==o&&!1!==o&&i.push(c[t][e])}return i},evaluateRule:(o,a)=>{var r=o.name,l=o.operator,o=o.value;if(m[a].includes(r)){let t=s[a].querySelectorAll('[name="'+r+'"]'),e,n,i;if(0<t.length){"radio"!==(e=t[0].type)&&"checkbox"!==e&&(t=t[0]);if("radio"==e||"checkbox"==e){n=[];for(let e=0;e<t.length;e++){t[e].checked&&n.push(t[e].value);e===t.length-1&&(n=n.join("|"))}}else n=t.value;i=g.compareValues(l,n,o)}return i}return!1},compareValues:(e,t,n)=>{t=t?t.toString().toLowerCase():"",n=n?n.toString().toLowerCase():"";switch(e){case"is":return n===t;case"isnot":return n!==t;case"greaterthan":return!isNaN(n)&&!isNaN(t)&&Number(n)>Number(t);case"lessthan":return!isNaN(n)&&!isNaN(t)&&Number(n)<Number(t);case"contains":return t.includes(n);case"doesnotcontain":return!t.includes(n);case"beginswith":return t.startsWith(n);case"doesnotbeginwith":return!t.startsWith(n);case"endswith":return t.endsWith(n);case"doesnotendwith":return!t.endsWith(n);case"isempty":return""===t;case"isnotempty":return""!==t}return!1},updateForm:async(a,e="add")=>{if(void 0!==s[a])if("add"==e)try{let n;n=await new Promise((e,t)=>{let n=[];if("inline"==l)n=s[a].querySelectorAll("[data-conditional-rules]");else{for(let t=0;l.length>t;t++)if("field"in l[t]){var i=(i=s[a].elements[l[t].field])instanceof RadioNodeList?Array.from(i):[i];for(let e=0;i.length>e;e++)if(void 0!==i[e]){var o=i[e];o.setAttribute("data-conditional-rules",JSON.stringify(l[t]));n.push(o)}delete l[t].field}l=null}if(0<n.length){c[a]=c[a].concat(Array.prototype.slice.call(n));e(n)}else t("No conditional fields found on step 1")});await new Promise((t,e)=>{if(0<n.length)for(let e=0;n.length>e;e++){g.initField(n[e],a);e===n.length-1&&t()}else e("No conditional fields to initialize on step 2")});if(0<m.length)for(let e=0;m[a].length>e;e++)if(!i[a].includes(m[a][e])){let t=s[a].querySelectorAll('[name="'+m[a][e]+'"]');if(0===t.length&&0<(t=s[a].querySelectorAll('[type="checkbox"][name="'+m[a][e]+'[]"]')).length){var o=m[a][e],r=(m[a][e]=m[a][e]+"[]",g.getDependantField(o,a));if(0<r.length)for(let i=0;r.length>i;i++)if(0<r[i].mfConditionalRules.length){let n=!1;for(let t=0;r[i].mfConditionalRules.length>t;t++)if("group"in r[i].mfConditionalRules[t]){for(let e=0;r[i].mfConditionalRules[t].group.length>e;e++)if(r[i].mfConditionalRules[t].group[e].name==o){r[i].mfConditionalRules[t].group[e].name=o+"[]";n=!0}}else if(r[i].mfConditionalRules[t].name==o){r[i].mfConditionalRules[t].name=o+"[]";n=!0}n&&g.updateField(r[i])}}if(0<t.length){for(let e=0;t.length>e;e++){t[e].mfConditionalFormIndex=a;t[e].addEventListener("change",g.fieldListener,!1)}i[a].push(m[a][e])}t=null}return!0}catch(t){if(n){let e="formIndex: "+a;void 0!==s[a].getAttribute("id")&&(e="formId: "+s[a].getAttribute("id"));console.info(e+" => "+t)}}else if("remove"==e){c[a]=c[a].filter(e=>void 0!==s[a].elements[""+e.name]);m[a]=m[a].filter(e=>void 0!==s[a].elements[""+e]);i[a]=i[a].filter(e=>void 0!==s[a].elements[""+e]);return!0}return!1},fieldListener:e=>{var t=g.getDependantField(e.target.name,e.target.mfConditionalFormIndex);if(0<t.length)for(let e=0;t.length>e;e++)g.updateField(t[e])},formListener:e=>{var t=e.target.mfConditionalFormIndex,e=e.detail.action;g.updateForm(t,e)}};if("block"==l){e=document.getElementById("rules-mf-conditional-fields");l=JSON.parse(e.innerHTML)}if("inline"!==l&&"object"!=typeof l)return n&&console.warn("The supplied rules or rule type is not valid."),!1;if(!(0<s.length))return n&&console.warn("The supplied conditional form was not found"),!1;for(let e=0;s.length>e;e++){c.push([]);m.push([]);i.push([]);s[e].mfConditionalFormIndex=e;g.updateForm(e)}if(t)for(let e=0;s.length>e;e++)s[e].addEventListener("mfConditionalFormUpdated",g.formListener,!1)};window.megaForms.conditionalFields=mfConditionalFields}window.megaForms.maxLengthHandler=e=>{var t=e.value.length,n=parseInt(e.getAttribute("maxlength"));n<t?e.value=e.value.substring(0,n):e.closest(".mf_input_container").querySelector("#mf_char_num").textContent=t+"/"+n};"undefined"!=typeof jQuery&&(jQuery.fn.serializeArrayLoose=function(){var i=/\r?\n/g,t=/^(?:submit|button|image|reset|file)$/i,n=/^(?:input|select|textarea|keygen)/i,o=/^(?:checkbox|radio)$/i;return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&n.test(this.nodeName)&&!t.test(e)&&(this.checked||!o.test(e))}).map(function(e,t){var n=jQuery(this).val();null==n&&(n="");return Array.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(i,"\r\n")}}):{name:t.name,value:n.replace(i,"\r\n")}}).get()})}!function(i,n){const t={formID:0,init:function(){this.forms=i(".single-mega-form");0<this.forms.length&&this.initActions()},initActions:function(){i(".single-mega-form").each(function(e){t.ajaxSetFormNonceValues(i(this))});t.initDatePicker()},initDatePicker:function(){void 0!==i.fn.datepicker&&i(".mform_fields").find(".datepicker-here").each(function(){var e={},t=i(this).attr("data-date-from"),n=i(this).attr("data-date-to");e.language="en";e.minDate=t?new Date(t+"-01-01"):new Date;if(n)e.maxDate=new Date(n+"-12-31");else{e.maxDate=new Date;e.maxDate.setFullYear(e.maxDate.getFullYear()+9)}i(this).datepicker(e)})},ajaxSetFormNonceValues:function(t){var e=i(t).attr("data-id");if(void 0!==e&&""!==e){i(t).addClass("mf-mask");n.ajax({data:{form_id:e},isadmin:!1,callback:"get_form_nonce_values",success:function(e){if(n.dev_env){console.log("%cSuccess","color: green; background: yellow; font-size: 20px");console.log(e)}i(t).find('input[name="_mf_referrer"]').val(e.form_referrer);i(t).find('input[name="_mf_nonce"]').val(e.form_token);i(t).find('input[name="_mf_extra_nonce"]').val(e.wp_nonce);i(t).removeClass("mf-mask")},fail:function(e){console.log("%cFail","color: red; background: yellow; font-size: 20px");console.log(e)}})}}};i(window).load(function(){t.init()})}(jQuery,megaForms,mfVars);