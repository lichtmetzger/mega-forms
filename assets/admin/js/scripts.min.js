/* (c) 2023 Mega Forms - https://wpmegaforms.com */
"use strict";const megaForms={context:mfCommonVars.context,ajaxurl:mfCommonVars.ajaxurl,ajax_public_action:"megaforms_public_request",ajax_admin_action:"megaforms_admin_request",dev_env:mfCommonVars.dev_env,ajax:(a,e="POST")=>{(a=a||{}).isadmin=a.isadmin||!1;a.data=a.data||{};a.callback=a.callback.replace(/-/g,"_")||"";a.before=a.before||!1;a.success=a.success||function(e){console.log(e)};a.fail=a.fail||function(e){console.log(e)};a.error=a.error||!1;a.complete=a.complete||!1;a.debug=a.debug||!1;let t="",i=a.data instanceof FormData,n={type:e,url:megaForms.ajaxurl,success:e=>{if(a.debug)a.success(e);else{e=JSON.parse(e);if(e.success){if(e.fail)"function"==typeof a.fail&&a.fail(e);else if("function"==typeof a.success){delete e.success;delete e.fail;a.success(e)}}else{a.isadmin?alert("AJAX error, check you browser console for more details."):alert("AJAX error, please refersh and try again.");console.log(e)}}},error:(e,t,i)=>{!1!==a.error&&"function"==typeof a.error&&a.error(e,t,i);console.log("XHR ERROR "+e.status+": "+i);a.isadmin?alert("Server side error, please error log file for more details."):alert("Server side error, please refersh and try again.")}};!1!==a.before&&"function"==typeof a.before&&(n.beforeSend=a.before());!1!==a.complete&&"function"==typeof a.complete&&(n.complete=a.complete());t=a.isadmin?megaForms.ajax_admin_action:megaForms.ajax_public_action;i?a.data.append("action",t):a.data.action=t;if(i){a.data.append("callback",a.callback);n.contentType=!1;n.processData=!1}else a.data.callback=a.callback;n.data=a.data;jQuery.ajax(n)},serializeForm:(e,t=!0)=>{let i={},a=t?jQuery(e).find(":input").serializeArrayLoose():jQuery(e).find(":input").serializeArray();jQuery.each(a,function(){var e=this.value,e=function e(t,i){if(t.length<1)return i;let a=t[0];"]"==a.slice(-1)&&(a=a.slice(0,-1));var n={};if(1==t.length)n[a=""==a?i:a]=i;else{t.shift();t=e(t,i);n[a]=t}return n}(this.name.split("["),e);jQuery.extend(!0,i,e)});return i}};if("undefined"!=typeof window){window.megaForms=megaForms;if("admin"==window.megaForms.context){window.wp=window.wp||{};window.megaForms.hooks=window.wp.hooks.createHooks()||{}}if("undefined"!=typeof mfConditionalFields)window.megaForms.conditionalFields=mfConditionalFields;else{const mfConditionalFields=(r,e={})=>{switch(typeof r){case"string":r=document.querySelectorAll(r);break;case"object":if(!1===Array.isArray(r)&&Object.prototype.hasOwnProperty.call(r,"0")){r=Object.fromEntries(Object.entries(r).filter(([e,t])=>!isNaN(e)&&void 0!==t.elements));r=Object.values(r)}else r=Array.isArray(r)?r:[r]}let l=e.rules||"inline",t=e.dynamic||!1,d=e.unsetHidden||!1,c=e.disableHidden||!1,i=e.debug||!1,f=e.depth||3,m=[],u=[],a=[],h={initField:(n,s)=>{var o=n.getAttribute("data-conditional-rules");if(0<o.length){let e="container"in(o=JSON.parse(o))?o.container:"",t="action"in o?o.action:"show",i="logic"in o?o.logic:"or",a="rules"in o?o.rules:[];if(0<(a="object"==typeof a&&void 0===a.length?[a]:a).length){for(let t=0;a.length>t;t++)if("group"in a[t])for(let e=0;a[t].group.length>e;e++)"name"in a[t].group[e]&&!u[s].includes(a[t].group[e].name)&&u[s].push(a[t].group[e].name);else"name"in a[t]&&!u[s].includes(a[t].name)&&u[s].push(a[t].name);n.removeAttribute("data-conditional-rules");n.mfConditionalContainerSelector=e;n.mfConditionalAction=t;n.mfConditionalLogic=i;n.mfConditionalRules=a;n.mfConditionalFormIndex=s;h.updateField(n)}}},updateField:(e,t=1)=>{let a=e.mfConditionalFormIndex,i=e.mfConditionalAction,n=e.mfConditionalLogic,s=e.mfConditionalRules,o=!1;if(0<s.length)for(let i=0;s.length>i;i++){let t=!1;if("group"in s[i]){var l,r=s[i].relation||"and";for(let e=0;s[i].group.length>e;e++){if(0==(l=h.evaluateRule(s[i].group[e],a))&&"and"==r){t=!1;break}if(l&&"or"==r){t=!0;break}t=l}}else t=h.evaluateRule(s[i],a);if(!1===t&&"and"==n){o=!1;break}if(t&&"or"==n){o=!0;break}o=t}o||(i="hide"==i?"show":"show"==i?"hide":"disable"==i?"enable":"enable"==i?"disable":"none");h.toggleField(e,i,t)},toggleField:(e,t,i)=>{let a=e.mfConditionalFormIndex,n=e.name,s=e.mfConditionalContainerSelector,o=null;if(i<f&&u[a].includes(n)){var l=h.getDependantField(n,a);if(0<l.length)for(let e=0;l.length>e;e++)"hide"==t?h.toggleField(l[e],"hide",i++):"show"==t&&h.updateField(l[e],i++)}if("hide"==t){""==s?e.setAttribute("hidden",!0):(o=e.closest(""+s))&&o.setAttribute("hidden",!0);c&&e.setAttribute("disabled","disabled");d&&("checkbox"==e.type||"radio"==e.type?e.checked=!1:e.value="")}else if("disable"==t)e.setAttribute("disabled","disabled");else if("enable"==t)e.hasAttribute("disabled")&&e.removeAttribute("disabled");else if("show"==t){""==s?e.removeAttribute("hidden"):(o=e.closest(""+s))&&o.removeAttribute("hidden");c&&e.removeAttribute("disabled")}},getDependantField:(i,t)=>{var a=[];if(void 0!==m[t])for(let e=0;m[t].length>e;e++)if("mfConditionalRules"in m[t][e]){var n=m[t][e].mfConditionalRules.some(t=>{if("group"in t){for(let e=0;t.group.length>e;e++)if(t.group[e].name===i)return!0;return!1}return t.name===i});void 0!==n&&!1!==n&&a.push(m[t][e])}return a},evaluateRule:(n,s)=>{var o=n.name,l=n.operator,n=n.value;if(u[s].includes(o)){let t=r[s].querySelectorAll('[name="'+o+'"]'),e,i,a;if(0<t.length){"radio"!==(e=t[0].type)&&"checkbox"!==e&&(t=t[0]);if("radio"==e||"checkbox"==e){i=[];for(let e=0;e<t.length;e++){t[e].checked&&i.push(t[e].value);e===t.length-1&&(i=i.join("|"))}}else i=t.value;a=h.compareValues(l,i,n)}return a}return!1},compareValues:(e,t,i)=>{t=t?t.toString().toLowerCase():"",i=i?i.toString().toLowerCase():"";switch(e){case"is":return i===t;case"isnot":return i!==t;case"greaterthan":return!isNaN(i)&&!isNaN(t)&&Number(i)>Number(t);case"lessthan":return!isNaN(i)&&!isNaN(t)&&Number(i)<Number(t);case"contains":return t.includes(i);case"doesnotcontain":return!t.includes(i);case"beginswith":return t.startsWith(i);case"doesnotbeginwith":return!t.startsWith(i);case"endswith":return t.endsWith(i);case"doesnotendwith":return!t.endsWith(i);case"isempty":return""===t;case"isnotempty":return""!==t}return!1},updateForm:async(s,e="add")=>{if(void 0!==r[s])if("add"==e)try{let i;i=await new Promise((e,t)=>{let i=[];if("inline"==l)i=r[s].querySelectorAll("[data-conditional-rules]");else{for(let t=0;l.length>t;t++)if("field"in l[t]){var a=(a=r[s].elements[l[t].field])instanceof RadioNodeList?Array.from(a):[a];for(let e=0;a.length>e;e++)if(void 0!==a[e]){var n=a[e];n.setAttribute("data-conditional-rules",JSON.stringify(l[t]));i.push(n)}delete l[t].field}l=null}if(0<i.length){m[s]=m[s].concat(Array.prototype.slice.call(i));e(i)}else t("No conditional fields found on step 1")});await new Promise((t,e)=>{if(0<i.length)for(let e=0;i.length>e;e++){h.initField(i[e],s);e===i.length-1&&t()}else e("No conditional fields to initialize on step 2")});if(0<u.length)for(let e=0;u[s].length>e;e++)if(!a[s].includes(u[s][e])){let t=r[s].querySelectorAll('[name="'+u[s][e]+'"]');if(0===t.length&&0<(t=r[s].querySelectorAll('[type="checkbox"][name="'+u[s][e]+'[]"]')).length){var n=u[s][e],o=(u[s][e]=u[s][e]+"[]",h.getDependantField(n,s));if(0<o.length)for(let a=0;o.length>a;a++)if(0<o[a].mfConditionalRules.length){let i=!1;for(let t=0;o[a].mfConditionalRules.length>t;t++)if("group"in o[a].mfConditionalRules[t]){for(let e=0;o[a].mfConditionalRules[t].group.length>e;e++)if(o[a].mfConditionalRules[t].group[e].name==n){o[a].mfConditionalRules[t].group[e].name=n+"[]";i=!0}}else if(o[a].mfConditionalRules[t].name==n){o[a].mfConditionalRules[t].name=n+"[]";i=!0}i&&h.updateField(o[a])}}if(0<t.length){for(let e=0;t.length>e;e++){t[e].mfConditionalFormIndex=s;t[e].addEventListener("change",h.fieldListener,!1)}a[s].push(u[s][e])}t=null}return!0}catch(t){if(i){let e="formIndex: "+s;void 0!==r[s].getAttribute("id")&&(e="formId: "+r[s].getAttribute("id"));console.info(e+" => "+t)}}else if("remove"==e){m[s]=m[s].filter(e=>void 0!==r[s].elements[""+e.name]);u[s]=u[s].filter(e=>void 0!==r[s].elements[""+e]);a[s]=a[s].filter(e=>void 0!==r[s].elements[""+e]);return!0}return!1},fieldListener:e=>{var t=h.getDependantField(e.target.name,e.target.mfConditionalFormIndex);if(0<t.length)for(let e=0;t.length>e;e++)h.updateField(t[e])},formListener:e=>{var t=e.target.mfConditionalFormIndex,e=e.detail.action;h.updateForm(t,e)}};if("block"==l){e=document.getElementById("rules-mf-conditional-fields");l=JSON.parse(e.innerHTML)}if("inline"!==l&&"object"!=typeof l)return i&&console.warn("The supplied rules or rule type is not valid."),!1;if(!(0<r.length))return i&&console.warn("The supplied conditional form was not found"),!1;for(let e=0;r.length>e;e++){m.push([]);u.push([]);a.push([]);r[e].mfConditionalFormIndex=e;h.updateForm(e)}if(t)for(let e=0;r.length>e;e++)r[e].addEventListener("mfConditionalFormUpdated",h.formListener,!1)};window.megaForms.conditionalFields=mfConditionalFields}window.megaForms.maxLengthHandler=e=>{var t=e.value.length,i=parseInt(e.getAttribute("maxlength"));i<t?e.value=e.value.substring(0,i):e.closest(".mf_input_container").querySelector("#mf_char_num").textContent=t+"/"+i};"undefined"!=typeof jQuery&&(jQuery.fn.serializeArrayLoose=function(){var a=/\r?\n/g,t=/^(?:submit|button|image|reset|file)$/i,i=/^(?:input|select|textarea|keygen)/i,n=/^(?:checkbox|radio)$/i;return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&i.test(this.nodeName)&&!t.test(e)&&(this.checked||!n.test(e))}).map(function(e,t){var i=jQuery(this).val();null==i&&(i="");return Array.isArray(i)?jQuery.map(i,function(e){return{name:t.name,value:e.replace(a,"\r\n")}}):{name:t.name,value:i.replace(a,"\r\n")}}).get()})}!function(g,l,v){const b={formID:0,lastFieldID:"",lastActionID:"",init:function(){this.formID=this.getFormID();this.lastFieldID=this.getLastFieldID(this.formID);this.lastActionID=this.getLastActionID();this.initContainersjQueryUI();this.initFieldsjQueryUI();this.initActionsjQueryUI();this.initGeneralEvents();this.initFieldsEvents();this.initComplete();l.hooks.doAction("editor.initialized",this.formID)},initContainersjQueryUI:function(){g("#mfields_holder").sortable({tolerance:"pointer",items:".mf-container",delay:50,cursor:"move",revert:!1,scroll:!1,scrollSensitivity:50,forcePlaceholderSize:!0,opacity:"0.9",placeholder:"mf-sortable-placeholder",start:function(e,t){t.item.addClass("mf-wrapper-sortable-active")},stop:function(e,t){t.item.removeClass("mf-wrapper-sortable-active")},cancel:".disable-sorting"}).disableSelection();g(".mf_col").sortable({items:".mfield",connectWith:".mf_col",delay:50,cursor:"move",revert:!1,scroll:!1,scrollSensitivity:50,opacity:"0.9",tolerance:"pointer",over:function(e,t){b.checkFieldsEmptyCols()},out:function(e,t){b.checkFieldsEmptyCols()},stop:function(e,t){b.checkFieldsEmptyCols()},update:function(e,t){g(t.item).hasClass("ui-draggable")&&(void 0===t.item.attr("data-type")?t.item.remove():b.addField.call(t.item,e,t.item))},cancel:".disable-sorting"})},initFieldsjQueryUI:function(e=!0,i="all"){g(".single_field_panel").find(".single_field").each(function(){var e=g(this).attr("id"),e=g("#"+e);if(e.length){var t=g(e).find(".field_options");g(t).is(".ui-tabs")||g(t).tabs({active:0});if("radios"==i||"checkboxes"==i||"select"==i||"all"==i){t=g(e).find(".mf-choices-list");g(t).is(".ui-sortable")&&"all"!=i||g(t).sortable({items:"li",axis:"y",handle:".sort",scroll:!1,stop:function(e,t){g(e.target).find("li").each(function(e){let t=e+1,i=g(this).find("input").attr("name"),a=i.split("[choices][")[1],n,s,o;n=a.substr(0,a.indexOf("]"));s="[choices]["+n+"]";o="[choices]["+t+"]";g(this).attr("data-key",t);g(this).find("input").each(function(){g(this).attr("name",g(this).attr("name").replace(s,o))})});b.refreshFieldPreview(e,e.target,{target:"none",action:"update_choices"})}})}}});if(e){g(".fields_list_panel").accordion({heightStyle:"content",active:0,collapsible:!0});g(".mg_field").draggable({helper:"clone",cursor:"move",opacity:"0.9",scroll:!1,scrollSensitivity:50,connectToSortable:".mf_col",tolerance:"pointer"})}},initActionsjQueryUI:function(e=!0){if(e){g("#megaforms_actions").accordion({heightStyle:"content",active:0,collapsible:!0});g(".mg_action").draggable({helper:"clone",cursor:"move",opacity:"0.9",scroll:!1,scrollSensitivity:50,connectToSortable:".mf_action_col",tolerance:"pointer"});g(".mf_action_col").sortable({items:".mfaction",handle:".action_controls",delay:50,cursor:"move",revert:!1,scroll:!1,scrollSensitivity:50,opacity:"0.9",tolerance:"pointer",placeholder:"mf_action_sortable_placeholder",over:function(e,t){b.checkActionsEmptyCol()},out:function(e,t){b.checkActionsEmptyCol()},stop:function(e,t){b.checkActionsEmptyCol()},update:function(e,t){g(t.item).hasClass("ui-draggable")&&(void 0===t.item.attr("data-type")?t.item.remove():b.addAction.call(t.item,e,t.item))},cancel:".disable-sorting"})}},initGeneralEvents:function(){g(".toggle-panels").find("button").click(this.togglePanels);g("#fullscreenbtn").click(this.switchFullScreen);g("#mform_save").click(this.saveForm);g("#mform_embed").click(this.embedForm);g("#mgform_title").click(this.renameForm);g("#megaforms_fields").find(".mg_field").click(this.addField);g("#mega-body-fields").find(".mf_add_container").click(this.addContainer);g("#mega-body-fields").find(".mf-containers-flyout-button").click(this.triggerInsertContainer);g("#megaforms_actions").find(".mg_action").click(this.addAction);g("#mega-body-settings").find("[data-toggle-show]").click(this.toggleAssociatedElements);g("#mfields_holder").on("click",".single_field",function(e){e.stopPropagation();b.selectField(e)});g("#mega-body-fields").on("click",function(e){b.unselectField(e);b.hideContainersFlyout(e)});g("#mega-body-fields").on("click",".container_control",function(e){b.handleContainerControls(e)});g("#mfields_holder").on("click",".field_control",function(e){b.handleFieldControls(e)});g("#mfactions_holder").on("click",".single_action .action_controls",function(e){e.stopPropagation();b.selectAction(e)});g("#mfactions_holder").on("click",".action_control",function(e){b.handleActionControls(e)});g(document).on("click",".mf-panel-toggler",function(e){b.changeDisplay(e)});g(document).on("click",".mf-inline-modal-btn",function(e){b.toggleInlineModal(e)});g(document).on("click",".mf-tooltip",function(e){b.showTooltip(e)})},initFieldsEvents:function(){g("form#mform_fields").change(b.handleFieldEdits);g("form#mform_fields").keypress(b.handleFieldEdits);g("form#mform_fields").keyup(b.handleFieldEdits);g("form#mform_fields").on("click","button",function(e){e.preventDefault();b.handleFieldEdits(e,!1)})},initComplete:function(e){b.checkFieldsEmptyCols();b.checkActionsEmptyCol();l.conditionalFields("#mform_fields, #mform_actions, #mform_settings",{dynamic:!0,disableHidden:!0,debug:l.dev_env});g(".initializing").removeClass("initializing")},onResize:function(){var e=document.body.scrollHeight;if(g("body").hasClass("fullscreen")){g(".mega-body-content").css("max-height","");g(".mega-container").css("max-height","")}else{e=e-215;g(".mega-body-content").css("max-height",e+"px");g(".mega-container").css("max-height",e+"px")}},togglePanels:function(e,t=!1){e.preventDefault();if(!1!==t){var i=g(".single_field_panel"),a=g(".edit-form__single-field-tab"),n=g(".fields_list_panel"),s=g(".edit-form__fields-tab");if("editor"==t){t=g(a).attr("data-current");g(i).find(".is-active").removeClass("is-active");g(i).find('[data-id="'+t+'"]').addClass("is-active");g(s).removeClass("is-active");g(a).addClass("is-active");g(n).removeClass("is-active");g(i).addClass("is-active")}else{g(".toggle-panels").find(".edit-form__single-field-tab").attr("data-current","empty");g("#mfields_holder").find(".selected").removeClass("selected");g(i).find(".is-active .tabs:first-child a").trigger("click");g(a).removeClass("is-active");g(s).addClass("is-active");g(i).removeClass("is-active");g(n).addClass("is-active")}}else g(this).hasClass("is-active")||(g(this).hasClass("edit-form__single-field-tab")?b.togglePanels(e,"editor"):b.togglePanels(e,"picker"))},selectField:function(e){e.preventDefault();var t=e.currentTarget;if(!g(t).hasClass("selected")){var i=g(t).data("id");g("#mfields_holder").find(".selected").removeClass("selected");g(t).addClass("selected");g(".toggle-panels").find(".edit-form__single-field-tab").attr("data-current",i);l.hooks.doAction("editor.fieldSelect",i);b.togglePanels(e,"editor")}},unselectField:function(e){if(!g(e.target).hasClass(".single_field")&&!g(e.target).closest(".single_field").length){e.preventDefault();g(".edit-form__single-field-tab").hasClass("is-active")&&b.togglePanels(e,"picker")}},hideContainersFlyout:function(e,t=!1){if((!0===t||!g(e.target).hasClass(".mf_add_container")&&!g(e.target).closest(".mf-containers-list, .mf_add_container").length)&&g(".mf_add_container").hasClass("active")){e.preventDefault();g(".mf_add_container").removeClass("active");g("#mf-containers-list").hide(0).removeClass("active").delay(300).show(0)}},selectAction:function(e){if(!g(e.target).hasClass(".action_control")&&!g(e.target).parents(".action_control").length){e.preventDefault();e=e.currentTarget,e=g(e).closest(".single_action");if(g(e).hasClass("selected"))g(e).removeClass("selected");else{l.hooks.doAction("editor.actionSelect",g(e).get(0));g("#mfactions_holder").find(".single_action.selected").removeClass("selected");g(e).addClass("selected")}}},switchFullScreen:function(e){e.preventDefault();g(window).scrollTop(0);g(".wp-toolbar").stop().toggleClass("fullscreen");g("body").stop().toggleClass("fullscreen");g("#wpcontent").stop().toggleClass("fullscreen");g("#mega-forms").stop().toggleClass("fullscreen");g("#mega-forms-container").stop().toggleClass("fullscreen");b.onResize()},addField:function(e,t=!1){var i=g(this).attr("data-type"),a=b.incrementFieldID(),n=g(this).attr("icon"),s=g(this).attr("value"),n=wp.template("single_field")({title:s,field_id:a,icon:n,type:i,spinner:v.spinner});!1===t?g("#mfields_holder").find(".mf-row-container").last().find(".mf_col").last().removeClass("mf-empty-col").append(n):g(t).replaceWith(n);b.getField({type:i,field_id:a,values:{field_label:s}})},addAction:function(e,t=!1){var i=g(this).attr("data-type"),a=b.incrementActionID(),n=g(this).attr("value"),s=wp.template("single_action")({title:n,action_id:a,type:i,spinner:v.spinner});!1===t?g("#mfactions_holder").find(".mf_action_col").removeClass("mf-empty-col").append(s):g(t).replaceWith(s);b.getAction(i,a,n)},addContainer:function(e){e.preventDefault();if(g(this).hasClass("has-children")){g(this).toggleClass("active");g(this).prev("#mf-containers-list").toggleClass("active")}else b.insertContainer(e,"row")},triggerInsertContainer:function(e){e.preventDefault();var t=g(this).attr("data-type");b.insertContainer(e,t)},renameForm:function(e){e.preventDefault();e=wp.template("rename-form-modal")({heading:v.labels.renameForm,desc:v.text.RenameFormText,label:v.labels.renameFormEg,submittext:v.labels.rename,spinner:v.spinner});g("body").append(e).find('[data-hook="modal-title-input"]').focus();g('[data-hook="modal-title-input"]').keyup(function(e){if(13==e.keyCode){e.preventDefault();e=g("#new_mgform_title").val();""!==e?b.updateFormName(e):g(this).siblings(".error").text(v.text.formNameError)}});g('[data-hook="modal-title-submit"]').click(function(e){e.preventDefault();e=g("#new_mgform_title").val();""!==e?b.updateFormName(e):g(this).siblings(".error").text(v.text.formNameError)})},embedForm:function(e){e.preventDefault();e=wp.template("empty-modal")({heading:v.labels.embedForm,desc:v.text.embedFormText,content:'<input class="display-shorcode" onclick="this.focus();this.select()" readonly="readonly" value="[megaforms id='+b.formID+']">'});g("body").append(e)},saveForm:function(e){e.preventDefault();var e=b.getAvailableContainers(),t=b.getAvailableContainerGlobalSettings(),i=b.convertFormFieldsToArray("form#mform_fields","fields"),a=b.convertFormFieldsToArray("form#mform_settings","settings"),n=b.convertFormFieldsToArray("form#mform_actions","actions");b.updateForm({settings:t,data:e},i,a,n)},showTooltip:function(e){e.preventDefault();let t=e.currentTarget,i=g(t).find("#tooltip-content"),a=0;g(t).hasClass("field-tooltip")?a=g(t).offset().top-g(t).closest(".tabs-panel").offset().top+18:g(t).hasClass("action-tooltip")?a=g(t).offset().top-g(t).closest(".single-action_panel").offset().top+18:g(t).hasClass("settings-tooltip")&&(a=g(t).offset().top-g(t).closest(".mfsetting_container, .mfoptions_container").offset().top+18);if(0!==a){g(i).css({top:a+"px"}).fadeIn();g(t).mouseleave(function(){g(i).fadeOut()})}},toggleInlineModal:function(e){e.preventDefault();let t=e.currentTarget,i=g(t).closest(".mf_field_container"),a=g(t).closest(".mf_field_container").closest("form"),r=g(t).attr("data-templates");if(g(t).hasClass("active")){g(i).find("#mf_inline_modal").remove();g(t).removeClass("active");g(a).removeClass("has_active_inline_modal")}else{if(g(a).hasClass("has_active_inline_modal")){g(a).find("#mf_inline_modal").remove();g(a).find(".mf-inline-modal-btn.active").removeClass("active");g(a).removeClass("has_active_inline_modal")}if(void 0!==r){r=r.split(",");let o="",l="";for(let s=0;r.length>s;s++){let t=r[s],i="";if("fields"==t){var d=b.getAvailableFields();for(let e=0;d.length>e;e++)i=(i=(i+='<a href="javascript:void(0)" data-tag="{mf:'+t+" "+d[e].id+'}" class="mf_insert_tag">')+('<span class="merge-tag-title">'+d[e].label+"</span>"))+('<span class="merge-tag-code">{mf:'+t+" "+d[e].id+"}</span>")+"</a>"}let e=wp.template("inline-modal-"+t),a=e({content:i}),n=null;(n=document.createElement("div")).innerHTML=a;var c=n.getElementsByClassName("inline-modal-tab-link")[0],f=n.getElementsByClassName("inline-modal-content")[0];if(0===s){g(c).addClass("active");g(f).addClass("active")}o+=c.outerHTML;l+=f.outerHTML;n=null}var e=wp.template("inline-modal")({tabs:o,content:l}),e=(g(i).append(e),g(i).find("#mf_inline_modal")),n=g(t).offset().top-g(t).closest(".tabs-panel, .single-action_panel").offset().top+28;g(e).css({top:n+"px"}).fadeIn();g(t).addClass("active");g(a).addClass("has_active_inline_modal");g(e).find(".mf_insert_tag").click(function(e){var t=g(this).closest(".mf_field_container").find("input, textarea").val()+g(this).attr("data-tag");g(this).closest(".mf_field_container").find("input, textarea").val(t).change()});g(e).find(".inline-modal-tab-link").click(function(e){var t=g(this).attr("data-id");g(this).siblings(".active").removeClass("active");g(this).addClass("active");g(this).closest("#mf_inline_modal").find(".inline-modal-content.active").removeClass("active");g(this).closest("#mf_inline_modal").find('.inline-modal-content[data-id="'+t+'"]').addClass("active")});g(e).closest(".field_container").mouseleave(function(e){g(i).find("#mf_inline_modal").remove();g(t).removeClass("active");g(a).removeClass("has_active_inline_modal");g(this).unbind(e)})}}},changeDisplay:function(e){e.preventDefault();var e=e.currentTarget,t=g(e).data("panel"),i=g(e).data("disable"),a=g(e).closest(".mf_tabs");g(e).siblings(".active").removeClass("active");(0<a.length?g(a).find("."+i+".active"):g("."+i+".active")).removeClass("active");g(e).addClass("active");(0<a.length?g(a).find("#"+t):g("#"+t)).addClass("active")},handleContainerControls:function(e){var t=e.currentTarget,i=g(t).data("action"),a=g(t).closest(".mf-container");if(void 0!==i&&""!==i){e.stopImmediatePropagation();e.stopPropagation();e.preventDefault();0<g(t).closest(".container_setting_controls").length?"edit"==i&&b.handleContainerSettingsEdit(t,a):"edit"==i?b.handleContainerEdit(t,a):"delete"==i?b.handleContainerDelete(t,a):"layout"==i&&b.handleRowLayout(t,a)}},handleFieldControls:function(e){var t=e.currentTarget,i=g(t).closest(".field_preview").attr("data-id"),a=g(t).data("action");if(void 0!==a&&""!==a){e.stopImmediatePropagation();e.stopPropagation();e.preventDefault();"duplicate"==a?b.handleFieldDuplicate(e,t,i):"delete"==a&&b.handleFieldDelete(e,t,i)}},handleActionControls:function(e){var t=e.currentTarget,i=g(t).closest(".single_action").attr("data-id"),a=g(t).data("action");if(void 0!==a&&""!==a){e.stopImmediatePropagation();e.stopPropagation();e.preventDefault();"delete"==a&&b.handleActionDelete(e,t,i)}},toggleAssociatedElements:function(e,t=!1){let i=0==t?e.currentTarget:g(t),a,n,s,o;if(1<g(i).length)g(i).each(function(e){if(g(this).is(":checked")){a=g(this).data("toggle-parent");n=g(this).data("toggle-hide");s=g(this).data("toggle-show");o=g(this).getVal()}});else{a=g(i).data("toggle-parent");n=g(i).data("toggle-hide");s=g(i).data("toggle-show");o=g(i).getVal()}if(a)if(o){n&&g(a).find(n).hide();g(a).find(s).show()}else{g(a).find(s).hide();n&&g(a).find(n).show()}},getField:function(t){let e=b.formID,i=g("#mfields_holder").find("[data-id='"+t.field_id+"']");t.form_id=e;l.ajax({data:t,isadmin:!0,callback:"get_field",success:function(e){g(i).replaceWith(e.display);g(".edit-form-panel-available_fields").append(e.settings);b.initFieldsjQueryUI(!1,t.type);b.triggerGlobalConditionsRefresh("fields","add")},fail:function(e){g(i).remove();b.showSnackbar({text:e.message,customClass:"failed"})}})},getAction:function(e,t,i=""){let a=b.formID,n=g("#mfactions_holder").find("[data-id='"+t+"']");l.ajax({data:{type:e,form_id:a,action_id:t,action_label:i},isadmin:!0,callback:"get_action",success:function(e){g(n).replaceWith(e.output);b.checkActionsEmptyCol();b.triggerGlobalConditionsRefresh("actions","add")},fail:function(e){g(n).remove();b.showSnackbar({text:e.message,customClass:"failed"})}})},updateFormName:function(t){let i=g('[data-hook="modal-response"]'),a=g('[data-hook="modal-title-input"]'),n=g('[data-hook="modal-title-submit"]');g(a).prop("disabled",!0);g(n).prop("disabled",!0);g(i).show();var e={form_name:t,form_id:b.formID};l.ajax({data:e,isadmin:!0,callback:"rename_form",success:function(e){g(i).find("span img").hide();g(i).find("span").append(e.message);g("#mgform_switcher").data("name",t);g("#mgform_switcher").find("span").text(t)},fail:function(e){g(a).prop("disabled",!1);g(n).prop("disabled",!1);g(i).hide();b.showSnackbar({text:e.message,customClass:"failed"})}})},updateForm:function(e,t,i,a){g("#saving").show();g("#mform_save").addClass("disabled");e={form_id:b.formID,containers:e,fields:t,settings:i,actions:a};l.ajax({data:e,isadmin:!0,callback:"update_form",success:function(e){g("#mform_save").removeClass("disabled");g("#saving").hide();b.showSnackbar({text:e.message,customClass:"success"})},fail:function(e){g("#mform_save").removeClass("disabled");g("#saving").hide();b.showSnackbar({text:e.message,customClass:"failed"})}})},getFormID:function(){let t=null,i;location.search.substr(1).split("&").forEach(function(e){"id"===(i=e.split("="))[0]&&(t=decodeURIComponent(i[1]))});null!=t&&""!=t&&!isNaN(t)||(t=g("#mform_fields").attr("data-id"));return parseInt(t)},getLastFieldID:function(e){var t=(t="mf_")+e+"_field_",e=g("#mform_fields").attr("data-last-field-id");let i=0;0<e&&(i=parseFloat(e));g("#mfields_holder").find(".single_field").each(function(){var e=parseFloat(g(this).attr("data-id")),e=0<e?e:0;e>i&&(i=e)});return t+=parseFloat(i)},getLastActionID:function(){let t=0;g("#mfactions_holder").find(".single_action").each(function(){var e=parseFloat(g(this).attr("data-id")),e=0<e?e:0;e>t&&(t=e)});return parseInt(t)},incrementFieldID:function(){var e=b.lastFieldID,t=e.lastIndexOf("_"),i=parseInt(e.substring(t+1))+1,e=(e=e.substring(0,t))+"_"+i;b.lastFieldID=e;return i},incrementActionID:function(){var e=b.lastActionID,e=parseInt(e)+1;return b.lastActionID=e},getAvailableFields:function(){let t=[];g(".edit-form-panel-available_fields").find("li.single_field").each(function(){if("0"==g(this).attr("data-is-static")){var e={id:g(this).attr("data-id"),type:g(this).attr("data-type"),label:g(this).find(".mf-inner-field_label input").val()};t.push(e)}});return t},handleFieldEdits:function(e,t=!0){t=t?e.target:e.currentTarget;if(void 0!==g(t).data("preview")){var i=g(t).data("preview");if("object"==typeof i&&void 0!==i.target&&void 0!==i.action){b.refreshFieldPreview(e,t,i);l.hooks.doAction("editor.fieldPreviewUpdate",e,t,i)}}else if(void 0!==g(t).data("edit")){i=g(t).data("edit");if("object"==typeof i&&void 0!==i.target&&void 0!==i.action){b.refreshFieldEditor(e,t,i);l.hooks.doAction("editor.fieldEditorUpdate",e,t,i)}}},refreshFieldPreview:function(e,t,i){let a=g(t).closest(".field_container").data("id"),o=g("#mega-body-fields").find("#mf_"+b.formID+"_field_"+a),n="none"===i.target?g(o):g(o).find(i.target),s=i.action,l=g(t).getVal(),r="args"in i?i.args:{};if(0<n.length)switch(s){case"update_label":g(n).html(l);break;case"update_label_visibility":"hidden"==l?g(n).find(".mf_field_container > label").addClass("mf_hidden"):g(n).find(".mf_field_container > label").removeClass("mf_hidden");break;case"update_sub_label":""==l&&(l=null==(l=g(t).attr("data-default"))?"":l);g(n).find(".mf_sub_label").html(l);break;case"update_placeholder":if(g(n).is("select")){""==l&&(l=null==(l=g(t).attr("data-default"))?"":l);g(n).find(".mf_select_placeholder").text(l)}else g(n).attr("placeholder",l);break;case"update_value":g(n).val(l);break;case"update_desc":""!==l?g(n).html(l):g(n).remove();break;case"update_required":if(!l){g(n).remove();g(o).removeClass("mfield_required ")}break;case"update_descPosition":var d=g(n).clone().addClass("mf_hidden");g(n).remove();if("top"==l){g(d).removeClass("mf_hidden");g(o).find(".mf_input_container").before(d)}else if("bottom"==l){g(d).removeClass("mf_hidden");g(o).find(".mf_input_container").after(d).removeClass("mf_hidden")}else g(o).find(".mf_input_container").after(d);break;case"update_subLabelPosition":g(o).find(".mf_sub_field").each(function(e){if("hidden"==l)g(this).find(".mf_sub_label").addClass("mf_hidden");else{var t=g(this).find(".mf_sub_label"),i=g(t).clone().removeClass("mf_hidden");g(t).remove();"top"==l?g(this).prepend(i):g(this).append(i)}});break;case"update_choices":var d=g(o).attr("data-type"),c=[];g(t).closest(".mf-choices-list").find("li").each(function(){var e={};e.label=g(this).find(".label").val();e.value=g(this).find(".label").val();e.default=g(this).find(".default").getVal();c.push(e)});if("select"==d){let a=g(o).find("select").find("option").first(),n="";g.each(c,function(e,t){var i=g(a).clone();g(i).val(t.value).text(t.label);t.default?g(i).attr("selected","selected"):g(i).removeAttr("selected");n+=g(i)[0].outerHTML});g(o).find("select").empty().append(n)}else{let n=g(o).find(".mf-choice").find("li").first(),s="";g.each(c,function(e,t){var i=g(n).clone(),a=g(i).find("input");g(a).val(t.value);t.default?g(a).attr("checked","checked"):g(a).removeAttr("checked");g(i).find(".mf-choice-desc").text(t.label);s+=g(i)[0].outerHTML});g(o).find(".mf-choice").empty().append(s)}break;case"toggle_field_inputs":var f="left";l?g(n).removeClass("mf_hidden"):g(n).addClass("mf_hidden");g(o).find(".mf_half").removeClass("left right");g(o).find(".mf_half").each(function(e){if(!g(this).hasClass("mf_hidden")){g(this).addClass(f);f="left"==f?"right":"left"}});break;case"update_divider_styles":var d=g(t).attr("data-style"),m="px";l<5&&("margin-top"==d||"margin-bottom"==d)&&(l=5);"width"==d&&(m="%");g(n).css(d,l+m);break;case"update_size":"half"==l?g(n).removeClass("mf_full").addClass("mf_half"):"full"==l&&g(n).removeClass("mf_half").addClass("mf_full");break;case"add_class":d=g(t).attr("data-add-class");void 0!==d&&g(n).addClass(d);break;case"remove_class":m=g(t).attr("data-remove-class");m&&g(n).removeClass(m);break;case"change_border_color":"color"in r&&(l?g(n).css("border-color",r.color):g(n).css("border-color",""))}else b.insertPreDefinedNodes(e,t,s,o,l,a,i.target)},refreshFieldEditor:function(e,t,i){var a=g(t).closest(".field_container"),n="none"===i.target?g(a):g(a).find(i.target),a=i.action,s=g(t).getVal(),o="args"in i?i.args:{};if(0<n.length)switch(a){case"show_choices_values":s?g(n).addClass("mf-choices-values-active"):g(n).removeClass("mf-choices-values-active");break;case"add_choice":var l=g(t).parent("li"),r=g(l).attr("data-key"),d=g(l).find(".default").attr("name"),c=g(l).find(".label").attr("name"),f=g(l).find(".value").attr("name"),m=g(l).clone(),u=0,h=(g(t).closest(".mf-choices-list").find("li").each(function(){var e=parseFloat(g(this).attr("data-key")),e=0<e?e:0;u<e&&(u=e)}),parseFloat(u)+1),d=d.replace("[choices]["+r+"]","[choices]["+h+"]"),c=c.replace("[choices]["+r+"]","[choices]["+h+"]"),f=f.replace("[choices]["+r+"]","[choices]["+h+"]"),r=g(m).find(".default"),p=g(m).find(".label"),_=g(m).find(".value");g(r).prop("checked",!1);g(p).val("");g(_).val("");g(r).attr("name",d);g(p).attr("name",c);g(_).attr("name",f);g(m).attr("data-key",h);g(m).insertAfter(l);b.refreshFieldPreview(e,t,{target:i.target,action:"update_choices"});break;case"remove_choice":if(1===g(t).closest(".mf-choices-list").find("li").length)b.showSnackbar({text:v.text.removeChoiceN,customClass:"warning"});else{r=g(t).parent("li").siblings("li").find(".remove");g(t).parent("li").remove();b.refreshFieldPreview(e,r,{target:i.target,action:"update_choices"})}break;case"select_default_choice":if("radio"==g(t).attr("type")){g(t).closest(".mf-choices-list").find("li").each(function(){g(this).find(".default").prop("checked",!1)});g(t).prop("checked",!0)}b.refreshFieldPreview(e,t,{target:i.target,action:"update_choices"});break;case"change_choice_label":d=g(t).next(".value"),p=g(d).val();if(t.defaultValue===p||g(t).attr("data-prev-val")===p||""==p){g(d).val(s);g(t).attr("data-prev-val",s)}b.refreshFieldPreview(e,t,{target:i.target,action:"update_choices"});break;case"navigate_input_settings":c=g(t).siblings(".active"),_=null;if(g(t).hasClass("next")){let e=g(c).next("span");_=e=0===e.length?g(c).siblings(".first"):e}else{let e=g(c).prev("span");_=e=0===e.length?g(c).siblings(".last"):e}g(c).removeClass("active");g(_).addClass("active");f=g(_).attr("data-type");g(".mf-field-inputs").find(".active").removeClass("active");g(".mf-field-inputs").find("."+f).addClass("active");break;case"toggle_custom_mask":"custom"==s?g(n).removeClass("mf_hidden"):g(n).addClass("mf_hidden");break;case"toggle_associated":b.toggleAssociatedElements(void 0,t);break;case"prevent_switch_off":g(t).prop("checked",!0);b.showSnackbar({text:"message"in o?o.message:v.text.removeInputN,customClass:"warning"})}},insertPreDefinedNodes:function(e,t,i,a,n,s,o){switch(i){case"update_label":g(a).find("label").prepend('<span class="mf_label">'+n+"</span>");break;case"update_desc":"top"==g(t).closest(".field_container").find('[name="field_description_position_mfield_'+s+'"]').getVal()?".mf-section-desc"==o?g(a).find(".mf_input_container").before('<p class="mf-section-desc">'+n+"</p>"):g(a).find(".mf_input_container").before('<span class="mf_description">'+n+"</span>"):".mf-section-desc"==o?g(a).find(".mf_input_container").after('<p class="mf-section-desc">'+n+"</p>"):g(a).find(".mf_input_container").after('<span class="mf_description">'+n+"</span>");break;case"update_required":if(n){g(a).addClass("mfield_required");g(a).find(".mf_field_container").children("label").append('<span class="mf_required">*</span>')}}},insertContainer:function(e,t){b.hideContainersFlyout(e,!0);if("row"==t){e=wp.template("single_row")({});g(e).insertAfter(g("#mfields_holder").find(".mf-container").last());b.checkFieldsEmptyCols()}else l.hooks.doAction("editor.insertContainer",t);b.initContainersjQueryUI()},getAvailableContainers:function(e){let i=[];g("#mfields_holder").find(".mf-container").each(function(e){let t={};t.type=g(this).attr("data-container");if("row"==t.type){let n=[],e=g(this).find(".mf_col");g.map(e,function(e,t){let i={},a=[];g(e).find(".mfield").each(function(e){a.push(g(this).attr("data-id"))});i.width=e.style.width;i.fields=a;n.push(i)});t.columns=n}else t=l.hooks.applyFilters("editor.containerData",t,g(this));i.push(t)});return i},getAvailableContainerGlobalSettings:function(e){let i={};g("#mfcontainers_settings").find("form.mf_container_global_settings").each(function(e){var t=g(this).attr("data-type");t&&(i[t]=l.serializeForm(this))});return i},convertFormFieldsToArray:function(e,t){let n=[];if("fields"==t){let a=b.formID;g(e).find(".single_field").each(function(e,t){var i={};i.id=g(t).attr("data-id");i.type=g(t).attr("data-type");i.formId=a;t=l.serializeForm(t,!1),i=Object.assign({},i,t);n.push(i)})}else if("settings"==t)g(e).find("li.mgform_settings").each(function(e,t){t=l.serializeForm(t,!1);n.push(t)});else if("actions"==t){var a=b.formID;g(e).find(".single_action").each(function(e,t){var i={};i.id=g(t).attr("data-id");i.type=g(t).attr("data-type");i.formId=a;t=l.serializeForm(t,!1),i=Object.assign({},i,t);n.push(i)})}return n},checkFieldsEmptyCols:function(e){let t=g(".mf_col");g(t).each(function(e){g(this).removeClass("mf-single-empty-col");if(g(this).find(".single_field, .mg_field").length<1){g(this).addClass("mf-empty-col");1===t.length&&g(this).addClass("mf-single-empty-col")}else g(this).removeClass("mf-empty-col")})},checkActionsEmptyCol:function(e){g(".mf_action_col").find(".mfaction, .mg_action").length<1?g(".mf_action_col").addClass("mf-empty-col"):g(".mf_action_col").removeClass("mf-empty-col")},showSnackbar:function(e){Snackbar.show(e)},handleFieldDuplicate:function(e,t,i){var i=g(".single_field_panel").find('[data-id="'+i+'"]'),t=g(t).closest(".field_preview"),a=b.incrementFieldID(),n=g(t).attr("data-type"),s=g('#mgfield_button[data-type="'+n+'"]').attr("icon"),o=g('#mgfield_button[data-type="'+n+'"]').attr("value"),o=wp.template("single_field")({title:o,field_id:a,icon:s,type:n,spinner:v.spinner}),s={type:n,field_id:a},n=(g(o).insertAfter(t).css("margin-top","10px"),document.createElement("form"));g(n).append(g(i).cloneFields());s.values=l.serializeForm(n);n=null;b.getField(s)},handleFieldDelete:function(t,i,a){b.showSnackbar({text:v.text.removeFieldY,showButton:!0,buttonText:v.text.yes,onButtonClick:function(e){e.style.opacity=0;g(i).closest(".field_preview").hasClass("selected")&&b.togglePanels(t,"picker");g(i).closest(".field_preview").fadeOut(300,function(){g(this).remove();b.checkFieldsEmptyCols();b.triggerGlobalConditionsRefresh("fields","remove")});g(".single_field_panel").find('[data-id="'+a+'"]').remove()}})},handleActionDelete:function(e,t,i){b.showSnackbar({text:v.text.removeActionY,showButton:!0,buttonText:v.text.yes,onButtonClick:function(e){e.style.opacity=0;g(t).closest(".single_action").fadeOut(300,function(){g(this).remove();b.checkActionsEmptyCol();b.triggerGlobalConditionsRefresh("actions","remove")})}})},handleContainerSettingsEdit:function(e,a){let n=g(a).attr("data-container"),s=g("#mfcontainers_settings").find('form[data-type="'+n+'"]');if(0<g(s).length){var a=g(s).attr("data-title")||n.toUpperCase(),o=g(s).attr("data-desc")||"",a=wp.template("empty-modal")({heading:a,desc:o,content:'<div id="mf_container_global_settings"><form class="mf_container_global_settings"></form><button class="save_container_settings button-primary" type="button" value="Save">Save</button></div>'});g("body").append(a);let t=document.getElementById("mgform_modal"),i=g(s).cloneFields(g(t).find("form.mf_container_global_settings"));g(i).show();l.conditionalFields(i,{debug:l.dev_env});g(".save_container_settings").click(function(e){e.preventDefault();null!==i&&g(i).cloneFields(s);g(t).remove()})}},handleContainerEdit:function(e,i){let a=g(i).attr("data-container"),n=g(i).find("form.mf_container_options");if(0<g(n).length){var i=g(n).attr("data-title")||a.toUpperCase(),s=g(n).attr("data-desc")||"",i=wp.template("empty-modal")({heading:i,desc:s,content:'<div id="mf_single_container_options"><form class="mf_container_options"></form><button class="save_container_options button-primary" type="button" value="Save">Save</button></div>'});g("body").append(i);let t=document.getElementById("mgform_modal");g(n).cloneFields(g(t).find("form.mf_container_options")).show();g(".save_container_options").click(function(e){e.preventDefault();e=t.querySelector("form.mf_container_options");null!==e&&g(e).cloneFields(n);t.remove()})}},handleContainerDelete:function(e,t){var i=g(t).attr("data-container");"row"==i?1===g("#mfields_holder").find(".mf-row-container").length?b.showSnackbar({text:v.text.removeRowN,customClass:"warning"}):b.showSnackbar({text:v.text.removeRowY,showButton:!0,buttonText:v.text.yes,onButtonClick:function(e){e.style.opacity=0;g(t).fadeOut(300,function(){g(this).find(".field_preview").each(function(e,t){var i=g(t).attr("data-id");g(t).remove();g(".single_field_panel").find('[data-id="'+i+'"]').remove()});g(this).remove()})}}):l.hooks.doAction("editor.deleteContainer",i,t)},handleRowLayout:function(t,l){function r(e){g(t).removeClass("active");g(c).unbind("input",u);g(o).unbind("click",m);g(t).unbind("click",f);g(l).unbind("mouseleave",f);g(n).remove()}let d=g(l).find(".mfcol_preview").length,e=g(t).closest(".container_controls"),i=wp.template("container_layout"),a=i({count:d}),n=(g(e).append(a),document.getElementById("mf_ctn_layout")),c=g(n).find(".mf_column-count__slider"),s=g(n).find(".mf_column-count__number"),o=g(n).find(".mf_column-count__save"),f=function(e){e.stopImmediatePropagation();e.stopPropagation();e.preventDefault();r()},m=function(e){e.preventDefault();let t=parseInt(g(c).val()),i=2<t?parseFloat(100/t).toFixed(2):parseInt(100/t),a=i+"%";if(t!==d&&0!==t){if(t>d){for(var n=t-d,s=wp.template("single_column")({}),o=0;o<n;o++)g(l).append(s);b.initContainersjQueryUI()}else{let i=d-t,a=[],n=0;g(g(l).find(".mfcol_preview").get().reverse()).each(function(e){if(n==i){for(var t=0;t<a.length;t++)g(this).append(a[t]);return!1}g(this).find(".field_preview").each(function(e){a.unshift(g(this))});g(this).remove();n++})}g(l).find(".mfcol_preview").each(function(e){g(this).css({width:a})});b.checkFieldsEmptyCols()}r()},u=function(e){g(this).next(s).html(this.value)};g(c).bind("input",u);g(o).bind("click",m);g(t).bind("click",f);g(l).bind("mouseleave",f);g(t).addClass("active");g(n).show()},triggerGlobalConditionsRefresh:function(e,t){var i=new CustomEvent("mfConditionalFormUpdated",{detail:{action:t}});switch(e){case"fields":document.getElementById("mform_fields").dispatchEvent(i);break;case"settings":document.getElementById("mform_settings").dispatchEvent(i);break;case"actions":document.getElementById("mform_actions").dispatchEvent(i)}}};if("mf_form_editor"==v.context){g(window).load(function(){b.onResize();b.init()});g(window).resize(function(){b.onResize()})}jQuery.fn.cloneFields=function(e=null,t=!0){let i=g(this).clone(t),a=g(this).find("select"),n=g(i).find("select");g(a).each(function(e){n.eq(e).val(g(this).val())});null!==e&&g(e).replaceWith(i);return i};jQuery.fn.removeClassRegex=function(i){return g(this).removeClass(function(e,t){return t.split(/\s+/).filter(function(e){return i.test(e)}).join(" ")})};jQuery.fn.getVal=function(){switch(g(this).attr("type")){case"radio":case"checkbox":return 1<g(this).length?g(this).filter(":checked").val()||!1:!!g(this).is(":checked")&&g(this).val()}return g(this).val()}}(jQuery,megaForms,mfVars);!function(a,t,n){const s={entryID:0,init:function(){this.entryID=this.getEntryID();this.initEntryjQueryUI();this.initGeneralEvents();this.initComplete()},initEntryjQueryUI:function(){a(".mf-entry-accordions").accordion({heightStyle:"content",active:0,collapsible:!0})},initGeneralEvents:function(){a("#fullscreenbtn").click(this.switchFullScreen);a(".mf_entry_show_hidden input").change(this.toggleEmptyFields);a("#mf_entry_save_note").click(this.addEntryNote);a("#mf_entry_sidebar").on("click",".mf-entry-note-delete",function(e){e.preventDefault();s.deleteEntryNote(e)});a(".mf-entry-action-edit").on("click",function(e){e.preventDefault();s.showEntryEditor(e)});a(".mf-entry-action-view").on("click",function(e){e.preventDefault();s.hideEntryEditor(e)});a("#mfentry_save").click(this.saveEntry)},initComplete:function(e){a("#mf_entry_sidebar").removeClass("mf_hidden");a(".initializing").removeClass("initializing")},switchFullScreen:function(e){e.preventDefault();a(window).scrollTop(0);a(".wp-toolbar").stop().toggleClass("fullscreen");a("body").stop().toggleClass("fullscreen");a("#wpcontent").stop().toggleClass("fullscreen");a("#mega-forms").stop().toggleClass("fullscreen");a("#mega-forms-container").stop().toggleClass("fullscreen")},toggleEmptyFields:function(e){a(this).is(":checked")?a(".mf-entry-values-table").find(".mf_entry_empty_row").removeClass("mf_hidden"):a(".mf-entry-values-table").find(".mf_entry_empty_row").addClass("mf_hidden")},deleteEntryNote:function(t){s.showSnackbar({text:n.text.deleteNoticeY,showButton:!0,buttonText:n.text.yes,onButtonClick:function(e){e.style.opacity=0;e=a(t.target).closest(".mf-entry-single-note").attr("data-id");a('.mf-entry-single-note[data-id="'+e+'"]').remove();0==a(".mf-entry-notes-list").find(".mf-entry-single-note").length&&a(".mf-entry-notes-list").find(".no-notes").removeClass("mf_hidden");s.ajaxDeleteNote(e)}})},addEntryNote:function(e){e.preventDefault();e=a('[name="mf_entry_note"]').val();if(0<e.length){a(this).addClass("disabled");s.ajaxAddNote(e)}else s.showSnackbar({text:n.text.addNoteN})},showEntryEditor:function(e){a("#mfentry_save").removeClass("mf_hidden");a(".mf-entry-action-view").removeClass("mf_hidden");a(".mf_entry_row").find(".edit").removeClass("mf_hidden");a(".mf-entry-action-edit").addClass("mf_hidden");a(".mf_entry_row").find(".view").addClass("mf_hidden");a(".mf_entry_row.mf_entry_empty_row.mf_hidden").removeClass("mf_hidden")},hideEntryEditor:function(e){a("#mfentry_save").addClass("mf_hidden");a(".mf-entry-action-view").addClass("mf_hidden");a(".mf_entry_row").find(".edit").addClass("mf_hidden");a(".mf-entry-action-edit").removeClass("mf_hidden");a(".mf_entry_row").find(".view").removeClass("mf_hidden");a('input[name="mf_entry_show_hidden"]').is(":checked")||a(".mf_entry_row.mf_entry_empty_row").addClass("mf_hidden")},saveEntry:function(e){e.preventDefault();e=t.serializeForm("form.single-mega-form");s.ajaxSaveEntry(e)},ajaxAddNote:function(i){var e={note:i,entry_id:s.entryID};t.ajax({data:e,isadmin:!0,callback:"add_entry_note",success:function(e){var t="",t=(t=(t+='<div class="mf-entry-single-note" data-id="'+e.id+'">')+('<span class="mf-entry-note-box">'+i+"</span>"))+('<span class="mf-entry-note-date">'+e.date+'<a href="#" class="mf-entry-note-delete">'+n.text.delete+"</a></span>")+"</div>";a(".mf-entry-notes-list").find(".no-notes").addClass("mf_hidden");a('[name="mf_entry_note"]').val("");a("#mf_entry_save_note").removeClass("disabled");a(".mf-entry-notes-list").append(t)},fail:function(e){s.showSnackbar({text:e.message,customClass:"failed"})}})},ajaxDeleteNote:function(e){e={note_id:e,entry_id:s.entryID};t.ajax({data:e,isadmin:!0,callback:"delete_entry_note",fail:function(e){s.showSnackbar({text:e.message,customClass:"failed"})}})},ajaxSaveEntry:function(e){a("#saving").show();a("#mfentry_save").addClass("disabled");e={entry_id:s.entryID,fields:e};t.ajax({data:e,isadmin:!0,callback:"save_entry_changes",success:function(e){a("#mfentry_save").removeClass("disabled");a("#saving").hide();s.showSnackbar({text:e.message});location.reload()},fail:function(i){a("#mfentry_save").removeClass("disabled");a("#saving").hide();a(".mf_entry_row").find(".edit").each(function(e){var t=a(this).attr("data-id");a(this).find(".mf_notice").remove();if(void 0!==t&&void 0!==i.notices[t]){a(this).addClass("mf_input_error");a(this).prepend('<span class="mf_notice">'+i.notices[t]+"</span>")}});s.showSnackbar({text:i.message,customClass:"failed"})}})},getEntryID:function(){let t=null,i;location.search.substr(1).split("&").forEach(function(e){"id"===(i=e.split("="))[0]&&(t=decodeURIComponent(i[1]))});null!=t&&""!=t&&!isNaN(t)||(t=a("#mf_entry_panel").attr("data-id"));return parseInt(t)},showSnackbar:function(e){Snackbar.show(e)}};"mf_entry_view"!=n.context&&"mf_entry_editor"!=n.context||a(window).load(function(){s.init()})}(jQuery,megaForms,mfVars);!function(o,t,l){const r={init:function(){var e=l.context;o(document).on("click",".close_mgform_modal",function(e){e.preventDefault();document.getElementById("mgform_modal").remove()});"mf_form_editor"!==e&&o(".mf-tooltip").click(this.showTooltip);if("mf_forms"==e||"mf_form_entries"==e){o("input#doaction").click(this.handleBulkAction);o('[data-hook="handle-item-action"]').click(this.handleSingleFormAction);o('[data-hook="expand-form-action"]').click(this.expandFromActions)}if("mf_forms"==e){o('[data-hook="change-form-status"]').change(this.changeFormStatus);o('[data-hook="show-form-modal"]').click(this.createFormModal)}if("mf_entries"==e||"mf_form_entries"==e){o('[data-hook="change-entry-star"]').click(this.changeEntryStar);o('[data-hook="show-entry-settings-modal"]').click(this.createEntriesSettingsModal)}if("mf_settings"==e){o(".mf-panel-toggler").click(this.showTab);void 0!==o.fn.wpColorPicker&&o(".mf-color-field").wpColorPicker();o('[data-hook="save-settings"]').click(this.saveSettings);o("input#uninstall").click(this.uninstallConfirmation)}if("mf_import_export"==e){o(".mf-panel-toggler").click(this.showTab);o('input[name="import_mf_forms"]').click(this.importForms);o('select[name="mf_export_entries_form"]').change(this.showFormFields);o('input[name="export_mf_forms"]').click(this.validateFormsExportFields);o('input[name="export_mf_entries"]').click(this.validateEntriesExportFields)}if("mf_settings"==e||"mf_import_export"==e){e=window.location.hash;e&&e.startsWith("#mfpanel-")&&this.showTab(null,window.location.hash.replace("#mfpanel-",""))}},expandFromActions:function(e){e.preventDefault();o(this).parent().stop().toggleClass("active");o(this).parent().closest("tr").mouseleave(function(){o(this).find('[data-hook="expand-form-action"]').parent().removeClass("active")})},changeFormStatus:function(e){let t=this.value,i=0;o(this).is(":checked")&&(i=1);r.ajaxChangeStatus({form_id:t,is_active:i})},createFormModal:function(e){e.preventDefault();e=wp.template("create-form-modal")({title:l.labels.create,label:l.labels.formName,spinner:l.spinner});o("body").append(e).find('[data-hook="modal-title-input"]').focus();o('[data-hook="modal-title-input"]').keydown(function(e){13==(e.keyCode||e.which)&&e.preventDefault()});o('[data-hook="modal-title-input"]').keyup(function(e){if(13==(e.keyCode||e.which)){e.preventDefault();e=o('[data-hook="modal-title-input"]').val();e?r.createNewMegaForm(e):o(this).closest(".mfield").siblings(".error").text(l.labels.formNameError)}});o('[data-hook="create-form"]').click(function(e){e.preventDefault();e=o('[data-hook="modal-title-input"]').val()?o('[data-hook="modal-title-input"]').val():o(this).attr("data-template-title");if(e){var t=o(this).attr("data-template-parent"),i=o(this).attr("data-template-type");r.createNewMegaForm(e,i,t)}else o(this).closest("form").find(".error").text(l.labels.formNameError)})},createNewMegaForm:function(e,t="blank",i="main"){o('[data-hook="modal-title-input"]').prop("disabled",!0);o('[data-hook="modal-title-submit"]').prop("disabled",!0);o('[data-hook="modal-response"]').show();e={form_name:e,template_type:t,template_parent:i};r.ajaxCreateNewForm(e)},handleBulkAction:function(e){if("delete_entries"==o("select#bulk-action-selector-top").val()){e.preventDefault();Snackbar.show({text:l.labels.deleteEntriesY,showButton:!0,buttonText:l.labels.yes,onButtonClick:function(e){e.style.opacity=0;o("form#mega_forms_list").submit()}})}},handleSingleFormAction:function(e){e.preventDefault();var e=o(this).attr("data-action"),t=o(this).attr("data-action-id");o('[name="single_action"]').val(e);o('[name="single_action_id"]').val(t);o("form#mega_forms_list").submit()},changeEntryStar:function(e){let t=this.value,i=0;o(this).is(":checked")&&(i=1);r.ajaxChangeEntryStar({entry_id:t,is_starred:i})},createEntriesSettingsModal:function(e){e.preventDefault();let t="",i=0,a=o(".mf_form_entries_page").find(".wp-list-table thead th"),n=[];o(a).each(function(e){var t=o(this).attr("id");if(0<=t.indexOf("field_id_")){t={id:t,label:o(this).text(),is_checked:!o(this).hasClass("hidden")};n.push(t)}});t=t+'<form method="post">'+'<table class="manage_hidden_fields_wrapper">';for(let e=0;e<n.length;++e){1==++i&&(t+="<tr>");var s=n[e].is_checked?'checked="checked"':"";t=(t=(t=(t=t+'<td class="mf-field-inputs-switch">'+'<label class="mfswitch mfswitch-size-small mfswitch-labelright">')+('<input type="checkbox" name="mf_form_entry_hidden_cols[]" value="'+n[e].id+'" '+s+" />"))+'<span class="mfswitch-slider round"></span>'+"</label>")+('<label for="mf_form_entry_hidden_cols[]" class="mf_label">'+n[e].label+"</label>")+"</td>";if(2==i){i=0;t+="</tr>"}}t=(t+="</table>")+('<input type="submit" id="submitButton" name="submitButton" value="'+l.labels.save+'" class="save_entry_hidden_cols button button-large button-primary">')+"</form>";e=wp.template("empty-modal")({heading:l.labels.changeColumns,desc:l.labels.changeColumnsDesc,content:t});o("body").append(e);o(".save_entry_hidden_cols").click(function(e){e.preventDefault();let t=o("#mega_forms_list").attr("data-id"),i=[],a=[];o(".manage_hidden_fields_wrapper").find(":checkbox:checked").each(function(e){i[e]=o(this).val()});o(n).each(function(e){var t=n[e].id;if(-1==jQuery.inArray(t,i)){a.push(n[e].id);o(".column-"+t).addClass("hidden")}else o(".column-"+t).removeClass("hidden")});e=0<o(a).length?o(a).length:0;o(".fields_count").find(".hidden_fields_count").text(e);r.ajaxSaveEntryHiddenCols({hidden_columns:a,form_id:t});document.getElementById("mgform_modal").remove()})},showTab:function(e,t=""){if(""!==t){var i=o("#mega-forms").find(".mf-panel-toggler.active"),a=o(i).data("disable"),n=o("#mega-forms").find(".mf-panel-toggler[data-panel="+t+"]");o(i).removeClass("active");o("#mega-forms").find("."+a+".active").removeClass("active");if(0<o(n).closest(".mfsetting_child_tab").length){i=o(n).closest(".mfsetting_child_tab");o(i).addClass("active");o(i).prev(".mf-panel-toggler").addClass("active")}o(n).addClass("active");o("#"+t).addClass("active")}else{e.preventDefault();a=e.currentTarget,i=o(a).data("panel"),n=o(a).data("disable"),t=o(a).data("has-children")||!1,e=o(a).data("is-children")||!1;if(!t){(e?o(a).parent("div"):o(a)).siblings(".active").removeClass("active");o("."+n+".active").removeClass("active")}e?o(a).closest(".mfsetting_child_tab").prev(".mf-panel-toggler").addClass("active"):o(".mfsetting_child_tab.active").removeClass("active");o(".mfsetting_child_tab").find("a.active").removeClass("active");o(a).addClass("active");o("#"+i).addClass("active");t||(window.location.hash="mfpanel-"+i)}},showTooltip:function(a){var e=a.target;if(o(e).hasClass("mf-tooltip")){a.preventDefault();let e=a.currentTarget,t=o(e).find("#tooltip-content"),i;if(0!=(i=o(e).offset().top-o(e).closest(".mfsetting_container").offset().top+18)){o(t).css({top:i+"px"}).fadeIn();o(e).mouseleave(function(){o(t).fadeOut()})}}},saveSettings:function(e){e.preventDefault();e=t.serializeForm("form#megaforms_options");r.ajaxSaveSettings({settings:e})},uninstallConfirmation:function(e){let t=this;if(1==o(t).prop("checked")){o(t).prop("checked",!1);Snackbar.show({text:l.labels.uninstallY,showButton:!0,buttonText:l.labels.yes,onButtonClick:function(e){e.style.opacity=0;o(t).prop("checked",!0)}})}},importForms:function(e){e.preventDefault();var e=new FormData,t=o("input#mf_import_file")[0].files;if(0==t.length)Snackbar.show({text:l.labels.selectFile,customClass:"failed"});else if("application/json"!==t[0].type)Snackbar.show({text:l.labels.selectJsonFile,customClass:"failed"});else{e.append("mf_import_file",t[0]);r.ajaxImportForms(e)}},showFormFields:function(e){e.preventDefault();e=o(this).val();if(""!==e){o(".mf_export_entries_fields").show();r.ajaxshowFormFields(e)}else o(".mf_export_entries_fields").hide()},validateFormsExportFields:function(e){var t=o('[name="mf_export_list[]"]').val();if(void 0===t||0==t.length){e.preventDefault();Snackbar.show({text:l.labels.selectExportForm,customClass:"failed"})}},validateEntriesExportFields:function(e){var t=o('[name="mf_export_entries_form"]').val(),i=o('[name="mf_export_entries_fields[]"]:checked');if(void 0===t||0==t.length){e.preventDefault();Snackbar.show({text:l.labels.selectExportEntriesForm,customClass:"failed"})}else if(void 0===i||0==i.length){e.preventDefault();Snackbar.show({text:l.labels.selectExportEntriesFields,customClass:"failed"})}},ajaxChangeStatus:function(e){t.ajax({data:e,isadmin:!0,callback:"set_form_status",success:function(e){},fail:function(e){Snackbar.show({text:e.message,customClass:"failed"})}})},ajaxChangeEntryStar:function(e){t.ajax({data:e,isadmin:!0,callback:"set_entry_star",success:function(e){},fail:function(e){Snackbar.show({text:e.message,customClass:"failed"})}})},ajaxCreateNewForm:function(e){t.ajax({data:e,isadmin:!0,callback:"create_form",success:function(e){var t=e.redirect;jQuery('[data-hook="modal-response"]').find("img").hide();if(0===t.length)jQuery('[data-hook="modal-response"]').find("span").append(e.message);else{jQuery('[data-hook="modal-response"]').find("span").append(e.message);location.href=t}},fail:function(e){jQuery("#mgform_modal").remove();Snackbar.show({text:e.message,customClass:"failed"})}})},ajaxSaveEntryHiddenCols:function(e){t.ajax({data:e,isadmin:!0,callback:"save_form_hidden_entry_columns",success:function(e){},fail:function(e){Snackbar.show({text:e.message,customClass:"failed"})}})},ajaxSaveSettings:function(e){t.ajax({data:e,isadmin:!0,callback:"save_settings",before:function(){o("#saving").show();o("#mfsettings_save").addClass("disabled")},success:function(e){o("#mfsettings_save").removeClass("disabled");o("#saving").hide();Snackbar.show({text:e.message})},fail:function(e){o("#mfsettings_save").removeClass("disabled");o("#saving").hide();Snackbar.show({text:e.message,customClass:"failed"})}})},ajaxImportForms:function(e){t.ajax({data:e,isadmin:!0,callback:"import_forms",before:function(){o("#saving").show();o('input[name="import_mf_forms"]').addClass("disabled")},success:function(e){o("input#mf_import_file").val("");o('input[name="import_mf_forms"]').removeClass("disabled");o("#saving").hide();Snackbar.show({text:e.message})},fail:function(e){o("input#mf_import_file").val("");o('input[name="import_mf_forms"]').removeClass("disabled");o("#saving").hide();Snackbar.show({text:e.message,customClass:"failed"})}})},ajaxshowFormFields:function(e){t.ajax({data:{form_id:e},isadmin:!0,callback:"get_form_fields",before:function(){o(".mf_export_entries_fields").find(".mf-inner-field").empty().append('<span><img src="'+l.spinner+'" /></span>')},success:function(e){o(".mf_export_entries_fields").find(".mf-inner-field").empty().append(e.message)},fail:function(e){o(".mf_export_entries_fields").hide();Snackbar.show({text:e.message,customClass:"failed"})}})}};o(window).load(function(){r.init()})}(jQuery,megaForms,mfVars);